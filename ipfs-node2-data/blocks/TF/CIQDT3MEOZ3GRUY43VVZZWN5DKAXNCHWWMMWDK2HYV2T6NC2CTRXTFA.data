");if(n===nl)return e.ONE;if(n===rl)return t;let r=e.ONE,i=t;for(;n>nl;)n&rl&&(r=e.mul(r,i)),i=e.sqr(i),n>>=rl;return r}(a,e,t),div:(t,n)=>ll(t*dl(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>dl(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?Gc(e,o):qc(e,o),fromBytes:e=>{if(e.length!==o)throw new Error("Fp.fromBytes: expected ".concat(o,", got ").concat(e.length));return n?Hc(e):Vc(e)}});return Object.freeze(a)}function vl(e){if("bigint"!==typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function bl(e){const t=vl(e);return t+Math.ceil(t/2)}const wl=BigInt(0),El=BigInt(1);function Al(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>wl;)n&El&&(r=r.add(i)),i=i.double(),n>>=El;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,l=e.BASE;const u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&u);o>>=d,r>a&&(r-=h,o+=El);const s=t,f=t+Math.abs(r)-1,p=e%2!==0,g=r<0;0===r?l=l.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:l}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}function Sl(e){return function(e){const t=gl.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});tl(e,t)}(e.Fp),tl(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...yl(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const _l=BigInt(0),Il=BigInt(1),Cl=BigInt(2),Tl=BigInt(8),kl={zip215:!0};function Rl(e){const t=function(e){const t=Sl(e);return tl(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:c}=t,l=Cl<<BigInt(8*a)-Il,u=n.create,h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(r){return{isValid:!1,value:_l}}}),d=t.adjustScalarBytes||(e=>e),f=t.domain||((e,t,n)=>{if(t.length||n)throw new Error("Contexts/pre-hash are not supported");return e}),p=e=>"bigint"===typeof e&&_l<e,g=(e,t)=>p(e)&&p(t)&&e<t,y=e=>e===_l||g(e,l);function m(e,t){if(g(e,t))return e;throw new Error("Expected valid scalar < ".concat(t,", got ").concat(typeof e," ").concat(e))}function v(e){return e===_l?e:m(e,r)}const b=new Map;function w(e){if(!(e instanceof E))throw new Error("ExtendedPoint expected")}class E{constructor(e,t,n,r){if(this.ex=e,this.ey=t,this.ez=n,this.et=r,!y(e))throw new Error("x required");if(!y(t))throw new Error("y required");if(!y(n))throw new Error("z required");if(!y(r))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof E)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};if(!y(t)||!y(n))throw new Error("invalid affine point");return new E(t,n,Il,u(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(E.fromAffine)}_setWindowSize(e){this._WINDOW_SIZE=e,b.delete(this)}assertValidity(){const{a:e,d:n}=t;if(this.is0())throw new Error("bad point: ZERO");const{ex:r,ey:i,ez:o,et:s}=this,a=u(r*r),c=u(i*i),l=u(o*o),h=u(l*l),d=u(a*e);if(u(l*u(d+c))!==u(h+u(n*u(a*c))))throw new Error("bad point: equation left != right (1)");if(u(r*i)!==u(o*s))throw new Error("bad point: equation left != right (2)")}equals(e){w(e);const{ex:t,ey:n,ez:r}=this,{ex:i,ey:o,ez:s}=e,a=u(t*s),c=u(i*r),l=u(n*s),h=u(o*r);return a===c&&l===h}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:i}=this,o=u(n*n),s=u(r*r),a=u(Cl*u(i*i)),c=u(e*o),l=n+r,h=u(u(l*l)-o-s),d=c+s,f=d-a,p=c-s,g=u(h*f),y=u(d*p),m=u(h*p),v=u(f*d);return new E(g,y,v,m)}add(e){w(e);const{a:n,d:r}=t,{ex:i,ey:o,ez:s,et:a}=this,{ex:c,ey:l,ez:h,et:d}=e;if(n===BigInt(-1)){const e=u((o-i)*(l+c)),t=u((o+i)*(l-c)),n=u(t-e);if(n===_l)return this.double();const r=u(s*Cl*d),f=u(a*Cl*h),p=f+r,g=t+e,y=f-r,m=u(p*n),v=u(g*y),b=u(p*y),w=u(n*g);return new E(m,v,w,b)}const f=u(i*c),p=u(o*l),g=u(a*r*d),y=u(s*h),m=u((i+o)*(c+l)-f-p),v=y-g,b=y+g,A=u(p-n*f),S=u(m*v),_=u(b*A),I=u(m*A),C=u(v*b);return new E(S,_,C,I)}subtract(e){return this.add(e.negate())}wNAF(e){return _.wNAFCached(this,b,e,E.normalizeZ)}multiply(e){const{p:t,f:n}=this.wNAF(m(e,r));return E.normalizeZ([t,n])[0]}multiplyUnsafe(e){let t=v(e);return t===_l?S:this.equals(S)||t===Il?this:this.equals(A)?this.wNAF(t).p:_.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,r).is0()}toAffine(e){const{ex:t,ey:r,ez:i}=this,o=this.is0();null==e&&(e=o?Tl:n.inv(i));const s=u(t*e),a=u(r*e),c=u(i*e);if(o)return{x:_l,y:Il};if(c!==Il)throw new Error("invZ was invalid");return{x:s,y:a}}clearCofactor(){const{h:e}=t;return e===Il?this:this.multiplyUnsafe(e)}static fromHex(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{d:i,a:o}=t,s=n.BYTES,a=(e=Wc("pointHex",e,s)).slice(),c=e[s-1];a[s-1]=-129&c;const d=Hc(a);d===_l||m(d,r?l:n.ORDER);const f=u(d*d),p=u(f-Il),g=u(i*f-o);let{isValid:y,value:v}=h(p,g);if(!y)throw new Error("Point.fromHex: invalid y coordinate");const b=(v&Il)===Il,w=0!==(128&c);if(!r&&v===_l&&w)throw new Error("Point.fromHex: x=0 and x_0=1");return w!==b&&(v=u(-v)),E.fromAffine({x:v,y:d})}static fromPrivateKey(e){return T(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=Gc(t,n.BYTES);return r[r.length-1]|=e&Il?128:0,r}toHex(){return jc(this.toRawBytes())}}E.BASE=new E(t.Gx,t.Gy,Il,u(t.Gx*t.Gy)),E.ZERO=new E(_l,Il,Il,_l);const{BASE:A,ZERO:S}=E,_=Al(E,8*a);function I(e){return ll(e,r)}function C(e){return I(Hc(e))}function T(e){const t=a;e=Wc("private key",e,t);const n=Wc("hashed private key",o(e),2*t),r=d(n.slice(0,t)),i=n.slice(t,2*t),s=C(r),c=A.multiply(s),l=c.toRawBytes();return{head:r,prefix:i,scalar:s,point:c,pointBytes:l}}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=Qc(...n);return C(o(f(s,Wc("context",e),!!i)))}const R=kl;A._setWindowSize(8);const x={getExtendedPublicKey:T,randomPrivateKey:()=>s(n.BYTES),precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};return{CURVE:t,getPublicKey:function(e){return T(e).pointBytes},sign:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=Wc("message",e),i&&(e=i(e));const{prefix:o,scalar:s,pointBytes:c}=T(t),l=k(r.context,o,e),u=A.multiply(l).toRawBytes(),h=I(l+k(r.context,u,c,e)*s);return v(h),Wc("result",Qc(u,Gc(h,n.BYTES)),2*a)},verify:function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R;const{context:s,zip215:a}=o,c=n.BYTES;e=Wc("signature",e,2*c),t=Wc("message",t),i&&(t=i(t));const l=Hc(e.slice(c,2*c));let u,h,d;try{u=E.fromHex(r,a),h=E.fromHex(e.slice(0,c),a),d=A.multiplyUnsafe(l)}catch(p){return!1}if(!a&&u.isSmallOrder())return!1;const f=k(s,h.toRawBytes(),u.toRawBytes(),t);return h.add(u.multiplyUnsafe(f)).subtract(d).clearCofactor().equals(E.ZERO)},ExtendedPoint:E,utils:x}}const xl=BigInt(0),Pl=BigInt(1);function Dl(e){const t=(tl(n=e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...n}));var n;const{P:r}=t,i=e=>ll(e,r),o=t.montgomeryBits,s=Math.ceil(o/8),a=t.nByteLength,c=t.adjustScalarBytes||(e=>e),l=t.powPminus2||(e=>ul(e,r-BigInt(2),r));function u(e,t,n){const r=i(e*(t-n));return[t=i(t-r),n=i(n+r)]}function h(e){if("bigint"===typeof e&&xl<=e&&e<r)return e;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const d=(t.a-BigInt(2))/BigInt(4);function f(e){return Gc(i(e),s)}function p(e,t){const n=function(e){const t=Wc("u coordinate",e,s);return a===s&&(t[a-1]&=127),Hc(t)}(t),r=function(e){const t=Wc("scalar",e);if(t.length!==s&&t.length!==a)throw new Error("Expected ".concat(s," or ").concat(a," bytes, got ").concat(t.length));return Hc(c(t))}(e),p=function(e,t){const n=h(e),r=h(t),s=n;let a,c=Pl,f=xl,p=n,g=Pl,y=xl;for(let l=BigInt(o-1);l>=xl;l--){const e=r>>l&Pl;y^=e,a=u(y,c,p),c=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1],y=e;const t=c+f,n=i(t*t),o=c-f,h=i(o*o),m=n-h,v=p+g,b=i((p-g)*t),w=i(v*o),E=b+w,A=b-w;p=i(E*E),g=i(s*i(A*A)),c=i(n*h),f=i(m*(n+i(d*m)))}a=u(y,c,p),c=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1];const m=l(f);return i(c*m)}(n,r);if(p===xl)throw new Error("Invalid private or public key received");return f(p)}const g=f(t.Gu);function y(e){return p(e,g)}return{scalarMult:p,scalarMultBase:y,getSharedSecret:(e,t)=>p(e,t),getPublicKey:e=>y(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:g}}const Ol=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Nl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Bl=(BigInt(0),BigInt(1)),Ll=BigInt(2),Ml=BigInt(5),Ul=BigInt(10),Fl=BigInt(20),Kl=BigInt(40),jl=BigInt(80);function Zl(e){const t=Ol,n=e*e%t*e%t,r=hl(n,Ll,t)*n%t,i=hl(r,Bl,t)*e%t,o=hl(i,Ml,t)*i%t,s=hl(o,Ul,t)*o%t,a=hl(s,Fl,t)*s%t,c=hl(a,Kl,t)*a%t,l=hl(c,jl,t)*c%t,u=hl(l,jl,t)*c%t,h=hl(u,Ul,t)*o%t;return{pow_p_5_8:hl(h,Ll,t)*e%t,b2:n}}function zl(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Vl(e,t){const n=Ol,r=ll(t*t*t,n),i=ll(r*r*t,n);let o=ll(e*r*Zl(e*i).pow_p_5_8,n);const s=ll(t*o*o,n),a=o,c=ll(o*Nl,n),l=s===e,u=s===ll(-e,n),h=s===ll(-e*Nl,n);return l&&(o=a),(u||h)&&(o=c),pl(o,n)&&(o=ll(-o,n)),{isValid:l||u,value:o}}const Hl=ml(Ol,void 0,!0),ql={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Hl,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Lc,randomBytes:Ic,adjustScalarBytes:zl,uvRatio:Vl},Gl=Rl(ql);function Wl(e,t,n){if(t.length>255)throw new Error("Context is too big");return Ac(wc("SigEd25519 no Ed25519 collisions"),new Uint8Array([n?1:0,t.length]),t,e)}const Ql=(()=>Dl({P:Ol,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=Ol,{pow_p_5_8:n,b2:r}=Zl(e);return ll(hl(n,BigInt(3),t)*r,t)},adjustScalarBytes:zl,randomBytes:Ic}))();const Yl=(Hl.ORDER+BigInt(3))/BigInt(8);Hl.pow(Ll,Yl),Hl.sqrt(Hl.neg(Hl.ONE)),Hl.ORDER,BigInt(5),BigInt(8),BigInt(486662);!function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);e.isOdd(n)&&e.neg(n)}(Hl,Hl.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class Jl extends Sc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,fc(e);const n=Ec(t);if(this.iHash=e.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return pc(this),this.iHash.update(e),this}digestInto(e){pc(this),dc(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Xl=(e,t,n)=>new Jl(e,t).update(n).digest();function $l(e,t,n){return fc(e),void 0===n&&(n=new Uint8Array(e.outputLen)),Xl(e,Ec(n),Ec(t))}Xl.create=(e,t)=>new Jl(e,t);const eu=new Uint8Array([0]),tu=new Uint8Array;function nu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;if(fc(e),hc(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=tu);const o=new Uint8Array(i*e.outputLen),s=Xl.create(e,t),a=s._cloneInto(),c=new Uint8Array(s.outputLen);for(let l=0;l<i;l++)eu[0]=l+1,a.update(0===l?tu:c).update(n).update(eu).digestInto(c),o.set(c,e.outputLen*l),s._cloneInto(a);return s.destroy(),a.destroy(),c.fill(0),eu.fill(0),o.slice(0,r)}const ru=(e,t,n)=>e&t^e&n^t&n,iu=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ou=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),su=new Uint32Array(64);class au extends Cc{constructor(){super(64,32,8,!1),this.A=0|ou[0],this.B=0|ou[1],this.C=0|ou[2],this.D=0|ou[3],this.E=0|ou[4],this.F=0|ou[5],this.G=0|ou[6],this.H=0|ou[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let h=0;h<16;h++,t+=4)su[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const e=su[h-15],t=su[h-2],n=bc(e,7)^bc(e,18)^e>>>3,r=bc(t,17)^bc(t,19)^t>>>10;su[h]=r+su[h-7]+n+su[h-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:l}=this;for(let h=0;h<64;h++){const e=l+(bc(s,6)^bc(s,11)^bc(s,25))+((u=s)&a^~u&c)+iu[h]+su[h]|0,t=(bc(n,2)^bc(n,13)^bc(n,22))+ru(n,r,i)|0;l=c,c=a,a=s,s=o+e|0,o=i,i=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,o,s,a,c,l)}roundClean(){su.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const cu=_c((()=>new au)),lu={hashSHA256:e=>cu(e.subarray()),getHKDF(e,t){const n=$l(cu,t,e),r=nu(cu,n,void 0,96);return[r.subarray(0,32),r.subarray(32,64),r.subarray(64,96)]},generateX25519KeyPair(){const e=Ql.utils.randomPrivateKey();return{publicKey:Ql.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:Ql.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>Ql.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,n,r)=>uc(r,t,n).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,n,r,i)=>uc(r,t,n).decrypt(e.subarray(),i)},uu=e=>{const t=(0,Us.E)(2);return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};uu.bytes=2;const hu=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};hu.bytes=2;class du extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),(0,Yo.Z)(this,"code",void 0),this.code=du.code}}(0,Yo.Z)(du,"code","ERR_UNEXPECTED_PEER");class fu extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),(0,Yo.Z)(this,"code",void 0),this.code=fu.code}}(0,Yo.Z)(fu,"code","ERR_INVALID_CRYPTO_EXCHANGE");n(85049),n(29835);var pu=n(7619),gu=n(60392),yu=n.n(gu),mu=n(80540),vu=n(39984),bu=n(46847),wu=n(56324),Eu=n(63877),Au=n.n(Eu),Su=(n(3055),n(18601));function _u(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Su.B)(n,"base64url")}function Iu(e){const t=function(e,t){let n=(0,mu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(yu().jsbn.BigInteger)((0,Su.B)(t,"base16"),16)}function Cu(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}const Tu=32,ku=64,Ru=32;function xu(e,t){const n=new Uint8Array(ku);for(let r=0;r<Ru;r++)n[r]=e[r],n[Ru+r]=t[r];return n}var Pu=n(98117);const Du={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},Ou={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function Nu(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=Du.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",Ou,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",Ou,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",Ou,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return Pu.base64.encode(r)}var Bu,Lu,Mu,Uu;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Bu||(Bu={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(Lu||(Lu={})),function(e){e.codec=()=>bs(Lu)}(Bu||(Bu={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Bu.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Bu.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Mu||(Mu={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Bu.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Bu.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Uu||(Uu={}));class Fu{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=Hu(e,Tu)}verify(e,t){return function(e,t,n){return Gl.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Mu.encode({Type:Bu.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=wu.sha256.digest(this.bytes);return Cu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class Ku{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=Hu(e,ku),this._publicKey=Hu(t,Tu)}sign(e){return function(e,t){const n=e.subarray(0,Ru);return Gl.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new Fu(this._publicKey)}marshal(){return this._key}get bytes(){return Uu.encode({Type:Bu.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=wu.sha256.digest(this.bytes);let t;return Cu(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=bu.identity.digest(this.public.bytes);return vu.base58btc.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Nu(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function ju(e){if(e.length>ku){const t=(e=Hu(e,ku+Tu)).subarray(0,ku),n=e.subarray(ku,e.length);return new Ku(t,n)}const t=(e=Hu(e,ku)).subarray(0,ku),n=e.subarray(Tu);return new Ku(t,n)}function Zu(e){return e=Hu(e,Tu),new Fu(e)}async function zu(){const{privateKey:e,publicKey:t}=function(){const e=Gl.utils.randomPrivateKey(),t=Gl.getPublicKey(e);return{privateKey:xu(e,t),publicKey:t}}();return new Ku(e,t)}async function Vu(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==Ru)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=Gl.getPublicKey(t);return{privateKey:xu(t,n),publicKey:n}}(e);return new Ku(t,n)}function Hu(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new pu.sv("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}const qu={"P-256":256,"P-384":384,"P-521":521};Object.keys(qu).join(" / ");n(34770);n(25493);function Gu(e,t){return t.map((t=>Iu(e[t])))}async function Wu(e){const t=[await Du.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Yu(e)],n=await Qu({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function Qu(e){if(null==e.privateKey||null==e.publicKey)throw new pu.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Du.get().subtle.exportKey("jwk",e.privateKey),Du.get().subtle.exportKey("jwk",e.publicKey)])}async function Yu(e){return Du.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Ju(e,t,n,r){const i=t?function(e){return yu().pki.setRsaPublicKey(...Gu(e,["n","e"]))}(e):function(e){return yu().pki.setRsaPrivateKey(...Gu(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Su.B)(n instanceof Uint8Array?n:n.subarray(),"ascii"),i);return(0,mu.m)(o,"ascii")}function Xu(e){if("RSA"!==e.kty)throw new pu.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new pu.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,mu.m)(e.n,"base64url").length}const $u=8192;class eh{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await Du.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Du.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new pu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.publicKeyToAsn1({n:Iu(e.n),e:Iu(e.e)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Mu.encode({Type:Bu.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Ju(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=wu.sha256.digest(this.bytes);return Cu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class th{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new pu.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Ic(e)}(16)}sign(e){return async function(e,t){const n=await Du.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Du.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new pu.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new eh(this._publicKey)}decrypt(e){return Ju(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new pu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.privateKeyToAsn1({n:Iu(e.n),e:Iu(e.e),d:Iu(e.d),p:Iu(e.p),q:Iu(e.q),dP:Iu(e.dp),dQ:Iu(e.dq),qInv:Iu(e.qi)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return Uu.encode({Type:Bu.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=wu.sha256.digest(this.bytes);return Cu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(yu().util.ByteBuffer)(this.marshal()),n=yu().asn1.fromDer(t),r=yu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return yu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return Nu(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function nh(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:_u(n.n),e:_u(n.e),d:_u(n.d),p:_u(n.p),q:_u(n.q),dp:_u(n.dP),dq:_u(n.dQ),qi:_u(n.qInv),alg:"RS256"}}(e);if(Xu(t)>$u)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await Wu(t);return new th(n.privateKey,n.publicKey)}function rh(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:_u(n.n),e:_u(n.e)}}(e);if(Xu(t)>$u)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new eh(t)}async function ih(e){if(Xu(e)>$u)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Wu(e);return new th(t.privateKey,t.publicKey)}async function oh(e){if(e>$u)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Du.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await Qu(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new th(t.privateKey,t.publicKey)}const{bytesToNumberBE:sh,hexToBytes:ah}=r,ch={Err:class extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}},_parseInt(e){const{Err:t}=ch;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:sh(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=ch,n="string"===typeof e?ah(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=ch._parseInt(n.subarray(2)),{d:s,l:a}=ch._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?"0".concat(t):t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return"30".concat(n(s+o+4),"02").concat(c).concat(i,"02").concat(a).concat(r)}},lh=BigInt(0),uh=BigInt(1),hh=(BigInt(2),BigInt(3));BigInt(4);function dh(e){const t=function(e){const t=Sl(e);tl(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof n||"bigint"!==typeof n.beta||"function"!==typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return Qc(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"===typeof e&&lh<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!==typeof e){if(e instanceof Uint8Array&&(e=jc(e)),"string"!==typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"===typeof e?e:Vc(Wc("private key",e,r))}catch(c){throw new Error("private key must be ".concat(r," bytes, hex or bigint, not ").concat(typeof e))}return i&&(s=ll(s,o)),a(s),s}const l=new Map;function u(e){if(!(e instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof h)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?h.ZERO:new h(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}static fromHex(e){const t=h.fromAffine(i(Wc("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),l=n.eql(n.mul(r,a),n.mul(s,i));return c&&l}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,hh),{px:o,py:s,pz:a}=this;let c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),u=n.mul(o,a),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,p),l=n.add(c,l),c=n.sub(f,l),l=n.add(f,l),l=n.mul(c,l),c=n.mul(g,c),u=n.mul(i,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),l=n.add(l,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),u=n.mul(p,f),u=n.add(u,u),u=n.add(u,u),new h(c,l,u)}add(e){u(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let l=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,hh);let y=n.mul(r,s),m=n.mul(i,a),v=n.mul(o,c),b=n.add(r,i),w=n.add(s,a);b=n.mul(b,w),w=n.add(y,m),b=n.sub(b,w),w=n.add(r,o);let E=n.add(s,c);return w=n.mul(w,E),E=n.add(y,v),w=n.sub(w,E),E=n.add(i,o),l=n.add(a,c),E=n.mul(E,l),l=n.add(m,v),E=n.sub(E,l),f=n.mul(p,w),l=n.mul(g,v),f=n.add(l,f),l=n.sub(m,f),f=n.add(m,f),d=n.mul(l,f),m=n.add(y,y),m=n.add(m,y),v=n.mul(p,v),w=n.mul(g,w),m=n.add(m,v),v=n.sub(y,v),v=n.mul(p,v),w=n.add(w,v),y=n.mul(m,w),d=n.add(d,y),y=n.mul(E,w),l=n.mul(b,l),l=n.sub(l,y),y=n.mul(b,m),f=n.mul(E,f),f=n.add(f,y),new h(l,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return f.wNAFCached(this,l,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}))}multiplyUnsafe(e){const r=h.ZERO;if(e===lh)return r;if(a(e),e===uh)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:l}=i.splitScalar(e),u=r,d=r,p=this;for(;s>lh||l>lh;)s&uh&&(u=u.add(p)),l&uh&&(d=d.add(p)),p=p.double(),s>>=uh,l>>=uh;return o&&(u=u.negate()),c&&(d=d.negate()),d=new h(n.mul(d.px,i.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:l,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);l=f.constTimeNegate(e,l),d=f.constTimeNegate(a,d),d=new h(n.mul(d.px,s.beta),d.py,d.pz),r=l.add(d),i=u.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return h.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=h.BASE,i=(e,t)=>t!==lh&&t!==uh&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===uh)return!0;if(n)return n(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===uh?this:n?n(h,this):this.multiplyUnsafe(t.h)}toRawBytes(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(h,this,e)}toHex(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return jc(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=Al(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function fh(e){const t=function(e){const t=Sl(e);return tl(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return ll(e,r)}function a(e){return dl(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=dh({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=Qc;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error("Point of length ".concat(t," was invalid. Expected ").concat(i," compressed bytes or ").concat(o," uncompressed bytes"))}{const e=Vc(s);if(!(lh<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let i=n.sqrt(t);return 1===(1&r)!==((i&uh)===uh)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>jc(qc(e,t.nByteLength));function f(e){return e>r>>uh}const p=(e,t,n)=>Vc(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=Wc("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=ch.toSig(Wc("DER",e));return new g(t,n)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:i,recovery:o}=this,l=b(Wc("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const u=2===o||3===o?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0===(1&o)?"02":"03",f=c.fromHex(h+d(u)),p=a(u),g=s(-l*p),y=s(i*p),m=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return zc(this.toDERHex())}toDERHex(){return ch.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return zc(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return l(e),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const e=bl(t.n);return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.length,i=vl(t),o=bl(t);if(r<16||r<o||r>1024)throw new Error("expected ".concat(o,"-1024 bytes of input, got ").concat(r));const s=ll(n?Vc(e):Hc(e),t-rl)+rl;return n?Gc(s,i):qc(s,i)}(t.randomBytes(e),t.n)},precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function m(e){const t=e instanceof Uint8Array,n="string"===typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const v=t.bits2int||function(e){const n=Vc(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(v(e))},w=Yc(t.nBitLength);function E(e){if("bigint"!==typeof e)throw new Error("bigint expected");if(!(lh<=e&&e<w))throw new Error("bigint expected < 2^".concat(t.nBitLength));return qc(e,t.nByteLength)}function A(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=Wc("msgHash",e),p&&(e=Wc("prehashed msgHash",o(e)));const m=b(e),w=l(r),A=[E(w),E(m)];if(null!=y){const e=!0===y?u(n.BYTES):y;A.push(Wc("extraEntropy",e))}const _=Qc(...A),I=m;return{seed:_,k2sig:function(e){const t=v(e);if(!h(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===lh)return;const o=s(n*s(I+i*w));if(o===lh)return;let l=(r.x===i?0:2)|Number(r.y&uh),u=o;return d&&f(o)&&(u=function(e){return f(e)?s(-e):e}(o),l^=1),new g(i,u,l)}}}const S={lowS:t.lowS,prehash:!1},_={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;const{seed:i,k2sig:o}=A(e,n,r),s=t;return $c(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r){var i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_;const l=e;if(n=Wc("msgHash",n),r=Wc("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:h}=o;let d,f;try{if("string"===typeof l||l instanceof Uint8Array)try{d=g.fromDER(l)}catch(S){if(!(S instanceof ch.Err))throw S;d=g.fromCompact(l)}else{if("object"!==typeof l||"bigint"!==typeof l.r||"bigint"!==typeof l.s)throw new Error("PARSE");{const{r:e,s:t}=l;d=new g(e,t)}}f=c.fromHex(r)}catch(I){if("PARSE"===I.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;h&&(n=t.hash(n));const{r:p,s:y}=d,m=b(n),v=a(y),w=s(m*v),E=s(p*v),A=null===(i=c.BASE.multiplyAndAddUnsafe(f,w,E))||void 0===i?void 0:i.toAffine();return!!A&&s(A.x)===p},ProjectivePoint:c,Signature:g,utils:y}}function ph(e){return{hash:e,hmac:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Xl(e,t,Ac(...r))},randomBytes:Ic}}const gh=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),yh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),mh=BigInt(1),vh=BigInt(2),bh=(e,t)=>(e+t/vh)/t;function wh(e){const t=gh,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=hl(u,n,t)*u%t,d=hl(h,n,t)*u%t,f=hl(d,vh,t)*l%t,p=hl(f,i,t)*f%t,g=hl(p,o,t)*p%t,y=hl(g,a,t)*g%t,m=hl(y,c,t)*y%t,v=hl(m,a,t)*g%t,b=hl(v,n,t)*u%t,w=hl(b,s,t)*p%t,E=hl(w,r,t)*l%t,A=hl(E,vh,t);if(!Eh.eql(Eh.sqr(A),e))throw new Error("Cannot find square root");return A}const Eh=ml(gh,void 0,void 0,{sqrt:wh}),Ah=function(e,t){const n=t=>fh({...e,...ph(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Eh,n:yh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=yh,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-mh*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=bh(o*e,t),c=bh(-r*e,t);let l=ll(e-a*n-c*i,t),u=ll(-a*r-c*o,t);const h=l>s,d=u>s;if(h&&(l=t-l),d&&(u=t-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},cu);BigInt(0);Ah.ProjectivePoint;function Sh(e){try{Ah.ProjectivePoint.fromHex(e)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PUBLIC_KEY")}}class _h{constructor(e){(0,Yo.Z)(this,"_key",void 0),Sh(e),this._key=e}verify(e,t){return function(e,t,n){const r=wu.sha256.digest(n instanceof Uint8Array?n:n.subarray());if(Cu(r))return r.then((n=>{let{digest:r}=n;return Ah.verify(t,r,e)})).catch((e=>{throw new pu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Ah.verify(t,r.digest,e)}catch(i){throw new pu.sv(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Ah.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Mu.encode({Type:Bu.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=wu.sha256.digest(this.bytes);let t;return Cu(e)?({bytes:t}=await e):t=e.bytes,t}}class Ih{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Ah.getPublicKey(e,!0)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Ah.getPublicKey(e,!0)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Sh(this._publicKey)}sign(e){return function(e,t){const n=wu.sha256.digest(t instanceof Uint8Array?t:t.subarray());if(Cu(n))return n.then((t=>{let{digest:n}=t;return Ah.sign(n,e).toDERRawBytes()})).catch((e=>{throw new pu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Ah.sign(n.digest,e).toDERRawBytes()}catch(r){throw new pu.sv(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new _h(this._publicKey)}marshal(){return this._key}get bytes(){return Uu.encode({Type:Bu.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=wu.sha256.digest(this.bytes);return Cu(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Nu(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Ch(e){return new Ih(e)}function Th(e){return new _h(e)}async function kh(){const e=Ah.utils.randomPrivateKey();return new Ih(e)}const Rh={rsa:o,ed25519:i,secp256k1:s};function xh(e){const t=Object.keys(Rh).join(" / ");return new pu.sv("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function Ph(e){var t,n;const r=Mu.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Bu.RSA:return Rh.rsa.unmarshalRsaPublicKey(i);case Bu.Ed25519:return Rh.ed25519.unmarshalEd25519PublicKey(i);case Bu.Secp256k1:return Rh.secp256k1.unmarshalSecp256k1PublicKey(i);default:throw xh(null!==(n=r.Type)&&void 0!==n?n:"unknown")}}async function Dh(e){var t,n;const r=Uu.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Bu.RSA:return Rh.rsa.unmarshalRsaPrivateKey(i);case Bu.Ed25519:return Rh.ed25519.unmarshalEd25519PrivateKey(i);case Bu.Secp256k1:return Rh.secp256k1.unmarshalSecp256k1PrivateKey(i);default:throw xh(null!==(n=r.Type)&&void 0!==n?n:"RSA")}}var Oh=n(3734);let Nh;const Bh=Symbol.for("nodejs.util.inspect.custom"),Lh=Object.values(Oh.gh).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Oh.gh.identity.decoder),Mh=114,Uh=36,Fh=37;Nh=Symbol.toStringTag;class Kh{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,pu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Nh](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=vu.base58btc.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Gr.CID.createV1(Mh,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return Vh(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Bh](){return"PeerId(".concat(this.toString(),")")}}class jh extends Kh{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Zh extends Kh{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class zh extends Kh{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function Vh(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:Lh,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=ni.Jx(vu.base58btc.decode("z".concat(e)));return e.startsWith("12D")?new Zh({multihash:t}):e.startsWith("16U")?new zh({multihash:t}):new jh({multihash:t})}return function(e){try{const t=ni.Jx(e);if(t.code===bu.identity.code){if(t.digest.length===Uh)return new Zh({multihash:t});if(t.digest.length===Fh)return new zh({multihash:t})}if(t.code===wu.sha256.code)return new jh({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Mh)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===wu.sha256.code)return new jh({multihash:e.multihash});if(t.code===bu.identity.code){if(t.digest.length===Uh)return new Zh({multihash:e.multihash});if(t.digest.length===Fh)return new zh({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Gr.CID.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(Lh.decode(e))}async function Hh(e,t){return e.length===Uh?new Zh({multihash:ni.Ue(bu.identity.code,e),privateKey:t}):e.length===Fh?new zh({multihash:ni.Ue(bu.identity.code,e),privateKey:t}):new jh({multihash:await wu.sha256.digest(e),publicKey:e,privateKey:t})}var qh,Gh;async function Wh(e,t,n){const r=await async function(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");return(await Dh(e.privateKey)).sign(t)}(e,Jh(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return function(e,t,n){return Gh.encode({identityKey:e,identitySig:t,extensions:null!==n&&void 0!==n?n:{webtransportCerthashes:[]}}).subarray()}(e.publicKey,r,n)}async function Qh(e){return Hh(e.identityKey)}function Yh(e){return Gh.decode(e)}function Jh(e){const t=(0,mu.m)("noise-libp2p-static-key:");return e instanceof Uint8Array?(0,Ls.z)([t,e],t.length+e.length):(e.prepend(t),e)}async function Xh(e,t,n){const r=await Hh(t.identityKey);if(!r.equals(n))throw new Error("Payload identity key ".concat(r.toString()," does not match expected remote peer ").concat(n.toString()));const i=Jh(e);if(null==r.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const o=Ph(r.publicKey);if(!await o.verify(i,t.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return r}function $h(e){return!!(e instanceof Uint8Array||js(e))&&32===e.byteLength}!function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={webtransportCerthashes:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(qh||(qh={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),qh.codec().encode(e.extensions,t)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identityKey:(0,Us.u)(0),identitySig:(0,Us.u)(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=qh.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(Gh||(Gh={}));var ed=n(27929);class td{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,Yo.Z)(this,"n",void 0),(0,Yo.Z)(this,"bytes",void 0),(0,Yo.Z)(this,"view",void 0),this.n=e,this.bytes=(0,Us.u)(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}class nd{constructor(e,t){(0,Yo.Z)(this,"crypto",void 0),(0,Yo.Z)(this,"log",void 0),this.log=e.logger.forComponent("libp2p:noise:abstract-handshake"),this.crypto=t}encryptWithAd(e,t,n){const r=this.encrypt(e.k,e.n,t,n);return e.n.increment(),r}decryptWithAd(e,t,n,r){const{plaintext:i,valid:o}=this.decrypt(e.k,e.n,t,n,r);return o&&e.n.increment(),{plaintext:i,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return(0,Us.u)(32)}isEmptyKey(e){const t=this.createEmptyKey();return(0,Ms.f)(t,e)}encrypt(e,t,n,r){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return n=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,n),n}decrypt(e,t,n,r,i){t.assertValue();const o=this.crypto.chaCha20Poly1305Decrypt(r,t.getBytes(),n,e,i);return o?{plaintext:o,valid:!0}:{plaintext:(0,Us.u)(0),valid:!1}}decryptAndHash(e,t){let n,r=!0;return this.hasKey(e.cs)?({plaintext:n,valid:r}=this.decryptWithAd(e.cs,e.h,t)):n=t,this.mixHash(e,t),{plaintext:n,valid:r}}dh(e,t){try{const n=this.crypto.generateX25519SharedKey(e,t);return 32===n.length?n:n.subarray(0,32)}catch(n){const e=n;return this.log.error("error deriving shared key",e),(0,Us.u)(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(new Zs(e,t))}mixKey(e,t){const[n,r]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(r),e.ck=n}initializeKey(e){return{k:e,n:new td}}initializeSymmetric(e){const t=(0,ed.mL)(e,"utf-8"),n=this.hashProtocolName(t),r=n,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:r,h:n}}hashProtocolName(e){if(e.length<=32){const t=(0,Us.u)(32);return t.set(e),t}return this.getHash(e,(0,Us.u)(0))}split(e){const[t,n]=this.crypto.getHKDF(e.ck,(0,Us.u)(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(n)}}writeMessageRegular(e,t){const n=this.encryptWithAd(e,(0,Us.u)(0),t);return{ne:this.createEmptyKey(),ns:(0,Us.u)(0),ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,(0,Us.u)(0),t.ciphertext)}}class rd extends nd{initializeInitiator(e,t,n,r){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:n,psk:r,re:(0,Us.u)(32)}}initializeResponder(e,t,n,r){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:n,psk:r,re:(0,Us.u)(32)}}writeMessageA(e,t,n){const r=(0,Us.u)(0);e.e=void 0!==n?n:this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i);return{ne:i,ns:r,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const r=e.s.publicKey,i=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:n,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const n=e.s.publicKey,r=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),o={ne:this.createEmptyKey(),ns:r,ciphertext:i},{cs1:s,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:o,cs1:s,cs2:a}}readMessageA(e,t){return $h(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if($h(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);r&&$h(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:r&&o}}readMessageC(e,t){const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);if(r&&$h(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:s,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:r&&o,cs1:s,cs2:a}}initSession(e,t,n){const r=this.createEmptyKey(),i=(0,Us.u)(32);let o;return o=e?this.initializeInitiator(t,n,i,r):this.initializeResponder(t,n,i,r),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let r;if(0===e.mc)r=this.writeMessageA(e.hs,t,n);else if(1===e.mc)r=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:n,messageBuffer:i,cs1:o,cs2:s}=this.writeMessageC(e.hs,t);r=i,e.h=n,e.cs1=o,e.cs2=s}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}recvMessage(e,t){let n=(0,Us.u)(0),r=!1;if(0===e.mc)({plaintext:n,valid:r}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:n,valid:r}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:o,valid:s,cs1:a,cs2:c}=this.readMessageC(e.hs,t);n=o,r=s,e.h=i,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:n,valid:r}}}function id(e,t){t.enabled&&Ta&&(e?(t("LOCAL_PUBLIC_EPHEMERAL_KEY ".concat((0,Su.B)(e.publicKey,"hex"))),t("LOCAL_PRIVATE_EPHEMERAL_KEY ".concat((0,Su.B)(e.privateKey,"hex")))):t("Missing local ephemeral keys."))}function od(e,t){t.enabled&&Ta&&t("REMOTE_EPHEMERAL_PUBLIC_KEY ".concat((0,Su.B)(e.subarray(),"hex")))}class sd{constructor(e,t,n,r,i,o,s,a,c){(0,Yo.Z)(this,"isInitiator",void 0),(0,Yo.Z)(this,"session",void 0),(0,Yo.Z)(this,"remotePeer",void 0),(0,Yo.Z)(this,"remoteExtensions",{webtransportCerthashes:[]}),(0,Yo.Z)(this,"payload",void 0),(0,Yo.Z)(this,"connection",void 0),(0,Yo.Z)(this,"xx",void 0),(0,Yo.Z)(this,"staticKeypair",void 0),(0,Yo.Z)(this,"prologue",void 0),(0,Yo.Z)(this,"log",void 0),this.log=e.logger.forComponent("libp2p:noise:xxhandshake"),this.isInitiator=t,this.payload=n,this.prologue=r,this.staticKeypair=o,this.connection=s,a&&(this.remotePeer=a),this.xx=null!==c&&void 0!==c?c:new rd(e,i),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(function(e,t){t.enabled&&Ta&&(t("LOCAL_STATIC_PUBLIC_KEY ".concat((0,Su.B)(e.publicKey,"hex"))),t("LOCAL_STATIC_PRIVATE_KEY ".concat((0,Su.B)(e.privateKey,"hex"))))}(this.session.hs.s,this.log),this.isInitiator){this.log.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,(0,Us.u)(0));await this.connection.write(function(e){return new Zs(e.ne,e.ciphertext)}(e)),this.log.trace("Stage 0 - Initiator finished sending first message."),id(this.session.hs.e,this.log)}else{this.log.trace("Stage 0 - Responder waiting to receive first message...");const e=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:(0,Us.u)(0)}}((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new fu("xx handshake stage 0 validation fail");this.log.trace("Stage 0 - Responder received first message."),od(this.session.hs.re,this.log)}}async exchange(){if(this.isInitiator){this.log.trace("Stage 1 - Initiator waiting to receive first message from responder...");const t=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}((await this.connection.read()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new fu("xx handshake stage 1 validation fail");this.log.trace("Stage 1 - Initiator received the message."),od(this.session.hs.re,this.log),function(e,t){t.enabled&&Ta&&t("REMOTE_STATIC_PUBLIC_KEY ".concat((0,Su.B)(e.subarray(),"hex")))}(this.session.hs.rs,this.log),this.log.trace("Initiator going to check remote's signature...");try{const e=Yh(n);this.remotePeer=this.remotePeer||await Qh(e),await Xh(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new du("Error occurred while verifying signed payload: ".concat(e.message))}this.log.trace("All good with the signature!")}else{this.log.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(function(e){return new Zs(e.ne,e.ns,e.ciphertext)}(e)),this.log.trace("Stage 1 - Responder sent the second handshake message with signed payload."),id(this.session.hs.e,this.log)}}async finish(){if(this.isInitiator){this.log.trace("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(function(e){return new Zs(e.ns,e.ciphertext)}(e)),this.log.trace("Stage 2 - Initiator sent message with signed payload.")}else{this.log.trace("Stage 2 - Responder waiting for third handshake message...");const t=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:(0,Us.u)(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}((await this.connection.read()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new fu("xx handshake stage 2 validation fail");this.log.trace("Stage 2 - Responder received the message, finished handshake.");try{const e=Yh(n);this.remotePeer=this.remotePeer||await Qh(e),await Xh(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){throw new du("Error occurred while verifying signed payload: ".concat(e.message))}}!function(e,t){t.enabled&&Ta&&(e.cs1&&e.cs2?(t("CIPHER_STATE_1 ".concat(e.cs1.n.getUint64()," ").concat((0,Su.B)(e.cs1.k,"hex"))),t("CIPHER_STATE_2 ".concat(e.cs2.n.getUint64()," ").concat((0,Su.B)(e.cs2.k,"hex")))):t("Missing cipher state."))}(this.session,this.log)}encrypt(e,t){const n=this.getCS(t);return this.xx.encryptWithAd(n,(0,Us.u)(0),e)}decrypt(e,t,n){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,(0,Us.u)(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.cs1||!e.cs2)throw new fu("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}class ad{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Yo.Z)(this,"protocol","/noise"),(0,Yo.Z)(this,"crypto",void 0),(0,Yo.Z)(this,"prologue",void 0),(0,Yo.Z)(this,"staticKeys",void 0),(0,Yo.Z)(this,"extensions",void 0),(0,Yo.Z)(this,"metrics",void 0),(0,Yo.Z)(this,"components",void 0);const{staticNoiseKey:n,extensions:r,crypto:i,prologueBytes:o}=t,{metrics:s}=e;this.components=e,this.crypto=null!==i&&void 0!==i?i:lu,this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKeys=n?this.crypto.generateX25519KeyPairFromSeed(n):this.crypto.generateX25519KeyPair(),this.prologue=null!==o&&void 0!==o?o:(0,Us.u)(0)}async secureOutbound(e,t,n){const r=ua(t,{lengthEncoder:uu,lengthDecoder:hu,maxDataLength:Ca}),i=await this.performHandshake({connection:r,isInitiator:!0,localPeer:e,remotePeer:n}),o=await this.createSecureConnection(r,i);return t.source=o.source,t.sink=o.sink,{conn:t,remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,n){const r=ua(t,{lengthEncoder:uu,lengthDecoder:hu,maxDataLength:Ca}),i=await this.performHandshake({connection:r,isInitiator:!1,localPeer:e,remotePeer:n}),o=await this.createSecureConnection(r,i);return t.source=o.source,t.sink=o.sink,{conn:t,remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){const t=await Wh(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:n,remotePeer:r,connection:i}=e,o=new sd(this.components,n,t,this.prologue,this.crypto,this.staticKeys,i,r);try{var s;await o.propose(),await o.exchange(),await o.finish(),null===(s=this.metrics)||void 0===s||s.xxHandshakeSuccesses.increment()}catch(c){var a;if(null===(a=this.metrics)||void 0===a||a.xxHandshakeErrors.increment(),c instanceof Error)throw c.message="Error occurred during XX handshake: ".concat(c.message),c}return o}async createSecureConnection(e,t){const[n,r]=function(){const e=ha(),t=ha();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await va(n,function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=65519){let i,o=n+65519;o>r.length&&(o=r.length),i=r instanceof Uint8Array?e.encrypt(r.subarray(n,o),e.session):e.encrypt(r.sublist(n,o),e.session),null===t||void 0===t||t.encryptedPackets.increment(),yield new Zs(uu(i.byteLength),i)}}}(t,this.metrics),i,(e=>Gs(e,{lengthDecoder:hu})),function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=Ca){let i=n+Ca;if(i>r.length&&(i=r.length),i-16<n)throw new Error("Invalid chunk");const o=r.sublist(n,i),s=r.subarray(n,i-16),{plaintext:a,valid:c}=e.decrypt(o,e.session,s);if(!c)throw null===t||void 0===t||t.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");null===t||void 0===t||t.decryptedPackets.increment(),yield a}}}(t,this.metrics),n),r}}function cd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new ad(t,e)}function ld(e){if(null!=e){if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"===typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}class ud{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class hd{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new ud(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new ud(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class dd extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function fd(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new hd,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new hd,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new hd,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new dd)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}var pd=n(9963);const gd="ERR_INVALID_FRAME",yd="ERR_UNREQUESTED_PING",md="ERR_NOT_MATCHING_PING",vd="ERR_STREAM_ALREADY_EXISTS",bd="ERR_DECODE_INVALID_VERSION",wd="ERR_BOTH_CLIENTS",Ed="ERR_RECV_WINDOW_EXCEEDED",Ad=new Set([gd,yd,md,vd,bd,wd,Ed]),Sd="ERR_INVALID_CONFIG",_d="ERR_MUXER_LOCAL_CLOSED",Id="ERR_MUXER_REMOTE_CLOSED",Cd=262144,Td={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:Cd,maxStreamWindowSize:16777216,maxMessageSize:65536};var kd,Rd;!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(kd||(kd={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(Rd||(Rd={}));Object.values(Rd).filter((e=>"string"!==typeof e));var xd;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(xd||(xd={}));const Pd=2**24;class Dd{constructor(e){(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"frameInProgress",void 0),this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new Zs,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:n}=e;t===kd.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,n)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new pu.sv("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new pu.sv("Invalid frame version",bd);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*Pd+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*Pd+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function Od(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}class Nd{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class Bd{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new Nd(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Nd(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class Ld extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function Md(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new Bd,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new Bd,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new Bd,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new Ld)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}function Ud(e,t){var n,r;const i=null===(n=(r=ld(e)).return)||void 0===n?void 0:n.call(r);var o;null!=(o=i)&&"function"===typeof o.then&&"function"===typeof o.catch&&"function"===typeof o.finally&&i.catch((e=>{t.error("could not cause iterator to return",e)}))}function Fd(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}class Kd{constructor(e){var t,n;(0,Yo.Z)(this,"id",void 0),(0,Yo.Z)(this,"direction",void 0),(0,Yo.Z)(this,"timeline",void 0),(0,Yo.Z)(this,"protocol",void 0),(0,Yo.Z)(this,"metadata",void 0),(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"status",void 0),(0,Yo.Z)(this,"readStatus",void 0),(0,Yo.Z)(this,"writeStatus",void 0),(0,Yo.Z)(this,"log",void 0),(0,Yo.Z)(this,"sinkController",void 0),(0,Yo.Z)(this,"sinkEnd",void 0),(0,Yo.Z)(this,"closed",void 0),(0,Yo.Z)(this,"endErr",void 0),(0,Yo.Z)(this,"streamSource",void 0),(0,Yo.Z)(this,"onEnd",void 0),(0,Yo.Z)(this,"onCloseRead",void 0),(0,Yo.Z)(this,"onCloseWrite",void 0),(0,Yo.Z)(this,"onReset",void 0),(0,Yo.Z)(this,"onAbort",void 0),(0,Yo.Z)(this,"sendCloseWriteTimeout",void 0),this.sinkController=new AbortController,this.sinkEnd=Ws(),this.closed=Ws(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=null!==(t=e.metadata)&&void 0!==t?t:{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=null!==(n=e.sendCloseWriteTimeout)&&void 0!==n?n:5e3,this.onEnd=e.onEnd,this.onCloseRead=null===e||void 0===e?void 0:e.onCloseRead,this.onCloseWrite=null===e||void 0===e?void 0:e.onCloseWrite,this.onReset=null===e||void 0===e?void 0:e.onReset,this.onAbort=null===e||void 0===e?void 0:e.onAbort,this.source=this.streamSource=function(){return Md((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new pu.sv('writable end state is "'.concat(this.writeStatus,'" not "ready"'),"ERR_SINK_INVALID_STATE");try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if("outbound"===this.direction){const e=this.sendNewStream(t);Fd(e)&&await e}const n=()=>{Ud(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let n of e){n=n instanceof Uint8Array?new Zs(n):n;const e=this.sendData(n,t);Fd(e)&&await e}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseRead)||void 0===t||t.call(this),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseWrite)||void 0===t||t.call(this),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await Promise.all([this.closeRead(e),this.closeWrite(e)]),await Ys(this.closed.promise,null===e||void 0===e?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully")}async closeRead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await Ys(this.sink([]),e.signal)),"writing"===this.writeStatus&&await new Promise(((t,n)=>{queueMicrotask((()=>{this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),Ys(this.sinkEnd.promise,e.signal).then(t,n)}))})),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var t;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");const n=this.sendReset();Fd(n)&&n.catch((e=>{this.log.error("error sending reset message",e)})),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),null===(t=this.onAbort)||void 0===t||t.call(this,e)}reset(){var e;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const t=new pu.sv("stream reset","ERR_STREAM_RESET");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(t),null===(e=this.onReset)||void 0===e||e.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("stream destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}const jd=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};function Zd(e){return null!=(null===e||void 0===e?void 0:e.then)}const zd=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e){const e=t(n);Zd(e)&&await e,yield n}}();const n=jd(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof(null===o||void 0===o?void 0:o.then))return async function*(){yield r;for await(const e of n){const n=t(e);Zd(n)&&await n,yield e}}();const s=t;return function*(){yield r;for(const e of n)s(e),yield e}()};var Vd;!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(Vd||(Vd={}));class Hd extends Kd{constructor(e){super({...e,onEnd:t=>{var n;this.state=Vd.Finished,null===(n=e.onEnd)||void 0===n||n.call(e,t)}}),(0,Yo.Z)(this,"name",void 0),(0,Yo.Z)(this,"state",void 0),(0,Yo.Z)(this,"config",void 0),(0,Yo.Z)(this,"_id",void 0),(0,Yo.Z)(this,"sendWindowCapacity",void 0),(0,Yo.Z)(this,"sendWindowCapacityUpdate",void 0),(0,Yo.Z)(this,"recvWindow",void 0),(0,Yo.Z)(this,"recvWindowCapacity",void 0),(0,Yo.Z)(this,"epochStart",void 0),(0,Yo.Z)(this,"getRTT",void 0),(0,Yo.Z)(this,"sendFrame",void 0),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=Cd,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=zd(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(e=e.sublist();0!==e.byteLength;){if(0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity(t),"open"!==this.status)return;const n=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),r=this.getSendFlags();this.sendFrame({type:kd.Data,flag:r,streamID:this._id,length:n},e.sublist(0,n)),this.sendWindowCapacity-=n,e.consume(n)}}async sendReset(){this.sendFrame({type:kd.WindowUpdate,flag:Rd.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|Rd.FIN;this.sendFrame({type:kd.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(){var e;let t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.sendWindowCapacity>0)return;const i=()=>{"open"===this.status?n(new pu.sv("stream aborted","ERR_STREAM_ABORT")):t()};null===(e=r.signal)||void 0===e||e.addEventListener("abort",i);try{await new Promise(((e,r)=>{this.sendWindowCapacityUpdate=()=>{e()},n=r,t=e}))}finally{var o;null===(o=r.signal)||void 0===o||o.removeEventListener("abort",i)}}handleWindowUpdate(e){var t;null===(t=this.log)||void 0===t||t.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const n=this.sendWindowCapacity;var r;(this.sendWindowCapacity+=e.length,0===n&&e.length>0)&&(null===(r=this.sendWindowCapacityUpdate)||void 0===r||r.call(this))}async handleData(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new pu.sv("receive window exceeded",Ed,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&Rd.ACK)===Rd.ACK&&this.state===Vd.SYNSent&&(this.state=Vd.Established),(e&Rd.FIN)===Rd.FIN&&this.remoteCloseWrite(),(e&Rd.RST)===Rd.RST&&this.reset()}getSendFlags(){switch(this.state){case Vd.Init:return this.state=Vd.SYNSent,Rd.SYN;case Vd.SYNReceived:return this.state=Vd.Established,Rd.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(0===e&&n>-1&&t-this.epochStart<4*n&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const r=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:kd.WindowUpdate,flag:e,streamID:this._id,length:r})}}const qd="/yamux/1.0.0";class Gd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Yo.Z)(this,"protocol",qd),(0,Yo.Z)(this,"_components",void 0),(0,Yo.Z)(this,"_init",void 0),this._components=e,this._init=t}createStreamMuxer(e){return new Wd(this._components,{...this._init,...e})}}class Wd{constructor(e,t){var n;(0,Yo.Z)(this,"protocol",qd),(0,Yo.Z)(this,"source",void 0),(0,Yo.Z)(this,"sink",void 0),(0,Yo.Z)(this,"config",void 0),(0,Yo.Z)(this,"log",void 0),(0,Yo.Z)(this,"logger",void 0),(0,Yo.Z)(this,"closeController",void 0),(0,Yo.Z)(this,"nextStreamID",void 0),(0,Yo.Z)(this,"_streams",void 0),(0,Yo.Z)(this,"nextPingID",void 0),(0,Yo.Z)(this,"activePing",void 0),(0,Yo.Z)(this,"rtt",void 0),(0,Yo.Z)(this,"client",void 0),(0,Yo.Z)(this,"localGoAway",void 0),(0,Yo.Z)(this,"remoteGoAway",void 0),(0,Yo.Z)(this,"numInboundStreams",void 0),(0,Yo.Z)(this,"numOutboundStreams",void 0),(0,Yo.Z)(this,"onIncomingStream",void 0),(0,Yo.Z)(this,"onStreamEnd",void 0),this.client="outbound"===t.direction,this.config={...Td,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),function(e){if(e.keepAliveInterval<=0)throw new pd.sv("keep-alive interval must be positive",Sd);if(e.maxInboundStreams<0)throw new pd.sv("max inbound streams must be larger or equal 0",Sd);if(e.maxOutboundStreams<0)throw new pd.sv("max outbound streams must be larger or equal 0",Sd);if(e.initialStreamWindowSize<Cd)throw new pd.sv("InitialStreamWindowSize must be larger or equal 256 kB",Sd);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new pd.sv("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",Sd);if(e.maxStreamWindowSize>2**32-1)throw new pd.sv("MaxStreamWindowSize must be less than equal MAX_UINT32",Sd);if(e.maxMessageSize<1024)throw new pd.sv("MaxMessageSize must be greater than a kilobyte",Sd)}(this.config),this.closeController=new AbortController,(0,pu.Wp)(1/0,this.closeController.signal),this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=function(){return fd((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({onEnd:()=>{var e;null===(e=this.log)||void 0===e||e.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{var t;const n=()=>{const t=ld(e);if(null!=t.return){const e=t.return();null!=(n=e)&&"function"===typeof n.then&&e.catch((e=>{var t;null===(t=this.log)||void 0===t||t.call(this,"could not cause sink source to return",e)}))}var n};let r,i;try{const t=new Dd(e);try{this.closeController.signal.addEventListener("abort",n);for await(const e of t.emitFrames())await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",n)}r=xd.NormalTermination}catch(a){const e=a.code;var o,s;if(Ad.has(e))null===(o=this.log)||void 0===o||o.error("protocol error in sink",a),r=xd.ProtocolError;else null===(s=this.log)||void 0===s||s.error("internal error in sink",a),r=xd.InternalError;i=a}null===(t=this.log)||void 0===t||t.trace("muxer sink ended"),null!=i?this.abort(i,r):await this.close({reason:r})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,null===(n=this.log)||void 0===n||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("keepalive error: %s",e)})),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}get streams(){return Array.from(this._streams.values())}newStream(e){var t;if(void 0!==this.remoteGoAway)throw new pu.sv("muxer closed remotely",Id);if(void 0!==this.localGoAway)throw new pu.sv("muxer closed locally",_d);const n=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new pu.sv("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");null===(t=this.log)||void 0===t||t.trace("new outgoing stream id=%s",n);const r=this._newStream(n,e,Vd.Init,"outbound");return this._streams.set(n,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new pu.sv("muxer closed remotely",Id);if(void 0!==this.localGoAway)throw new pu.sv("muxer closed locally",_d);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,n)=>{const r=()=>{n(new pu.sv("muxer closed locally",_d))};this.closeController.signal.addEventListener("abort",r,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",r),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.closeController.signal.aborted)return;const i=null!==(e=null===(t=r)||void 0===t?void 0:t.reason)&&void 0!==e?e:xd.NormalTermination;if(null===(n=this.log)||void 0===n||n.trace("muxer close reason=%s",i),null==r.signal){const e=AbortSignal.timeout(500);(0,pu.Wp)(1/0,e),r={...r,signal:e}}try{await Promise.all([...this._streams.values()].map((async e=>e.close(r)))),this.sendGoAway(i),this._closeMuxer()}catch(o){this.abort(o)}}abort(e,t){var n,r;if(!this.closeController.signal.aborted){t=null!==(n=t)&&void 0!==n?n:xd.InternalError,null===(r=this.log)||void 0===r||r.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,r){if(null!=this._streams.get(e))throw new pu.sv("Stream already exists",vd,{id:e});const i=new Hd({id:e.toString(),name:t,state:n,direction:r,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var t;this.closeStream(e),null===(t=this.onStreamEnd)||void 0===t||t.call(this,i)},log:this.logger.forComponent("libp2p:yamux:".concat(r,":").concat(e)),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var e;const t=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(null===(e=this.log)||void 0===e||e.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{await Promise.race([t,new Promise((t=>{e=setTimeout(t,this.config.keepAliveInterval)}))]),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}catch(n){return void clearInterval(e)}}}async handleFrame(e,t){var n;const{streamID:r,type:i,length:o}=e;if(null===(n=this.log)||void 0===n||n.trace("received frame %o",e),0===r)switch(i){case kd.Ping:return void this.handlePing(e);case kd.GoAway:return void this.handleGoAway(o);default:throw new pu.sv("Invalid frame type",gd,{header:e})}else switch(e.type){case kd.Data:case kd.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new pu.sv("Invalid frame type",gd,{header:e})}}handlePing(e){if(e.flag===Rd.SYN){var t;null===(t=this.log)||void 0===t||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,Rd.ACK)}else{if(e.flag!==Rd.ACK)throw new pu.sv("Invalid frame flag",gd,{header:e});var n;null===(n=this.log)||void 0===n||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new pu.sv("ping not requested",yd);if(this.activePing.id!==e)throw new pu.sv("ping doesn't match our id",md);this.activePing.resolve()}handleGoAway(e){var t,n;null===(t=this.log)||void 0===t||t.trace("received GoAway reason=%s",null!==(n=xd[e])&&void 0!==n?n:"unknown"),this.remoteGoAway=e;for(const r of this._streams.values())r.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:n,flag:r,type:i}=e;(r&Rd.SYN)===Rd.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(void 0!==o)switch(i){case kd.WindowUpdate:return void o.handleWindowUpdate(e);case kd.Data:if(void 0===t)throw new Error("unreachable");return void await o.handleData(e,t);default:throw new Error("unreachable")}else if(i===kd.Data){var s;if(null===(s=this.log)||void 0===s||s.call(this,"discarding data for stream id=%s",n),void 0===t)throw new Error("unreachable");await t()}else{var a;null===(a=this.log)||void 0===a||a.call(this,"frame for missing stream id=%s",n)}}incomingStream(e){var t,n,r;if(this.client!==(e%2===0))throw new pu.sv("both endpoints are clients",wd);if(this._streams.has(e))return;if(null===(t=this.log)||void 0===t||t.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:kd.WindowUpdate,flag:Rd.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return null===(r=this.log)||void 0===r||r.call(this,"maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:kd.WindowUpdate,flag:Rd.RST,streamID:e,length:0});const i=this._newStream(e,void 0,Vd.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,i),null===(n=this.onIncomingStream)||void 0===n||n.call(this,i)}sendFrame(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("sending frame %o",e),e.type===kd.Data){if(void 0===t)throw new pu.sv("invalid frame",gd);this.source.push(new Zs(Od(e),t))}else this.source.push(Od(e))}sendPing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rd.SYN;var n,r;t===Rd.SYN?null===(n=this.log)||void 0===n||n.trace("sending ping request pingId=%s",e):null===(r=this.log)||void 0===r||r.trace("sending ping response pingId=%s",e);this.sendFrame({type:kd.Ping,flag:t,streamID:0,length:e})}sendGoAway(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xd.NormalTermination;null===(e=this.log)||void 0===e||e.call(this,"sending GoAway reason=%s",xd[t]),this.localGoAway=t,this.sendFrame({type:kd.GoAway,flag:0,streamID:0,length:t})}}function Qd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new Gd(t,e)}var Yd=n(97723);function Jd(e,t){(0,Yd.Z)(e,t),t.add(e)}function Xd(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}const $d=Symbol.for("@libp2p/content-routing");class ef extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"The operation was aborted"),(0,Yo.Z)(this,"code",void 0),(0,Yo.Z)(this,"type",void 0),this.code=ef.code,this.type=ef.type}}(0,Yo.Z)(ef,"code","ABORT_ERR"),(0,Yo.Z)(ef,"type","aborted");class tf extends Error{constructor(e,t,n){var r;super(e),(0,Yo.Z)(this,"code",void 0),(0,Yo.Z)(this,"props",void 0),this.code=t,this.name=null!==(r=null===n||void 0===n?void 0:n.name)&&void 0!==r?r:"CodeError",this.props=null!==n&&void 0!==n?n:{}}}class nf extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),(0,Yo.Z)(this,"code",void 0),this.code=nf.code}}(0,Yo.Z)(nf,"code","ERR_UNEXPECTED_PEER");class rf extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),(0,Yo.Z)(this,"code",void 0),this.code=rf.code}}(0,Yo.Z)(rf,"code","ERR_INVALID_CRYPTO_EXCHANGE");class of extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto transmission"),(0,Yo.Z)(this,"code",void 0),this.code=of.code}}(0,Yo.Z)(of,"code","ERR_INVALID_CRYPTO_TRANSMISSION");const sf=Symbol.for("@libp2p/peer-routing");var af=n(18392),cf=n.n(af);var lf=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const uf=lf,hf=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class df{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class ff{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return gf(this,e)}}class pf{constructor(e){this.decoders=e}or(e){return gf(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const gf=(e,t)=>new pf({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class yf{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new df(e,t,n),this.decoder=new ff(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const mf=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new yf(t,n,r,i)},vf=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=uf(r,n);return mf({prefix:t,name:n,encode:i,decode:e=>hf(o(e))})},bf=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return mf({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},wf=bf({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ef=bf({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Af=bf({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sf=bf({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_f=bf({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),If=bf({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Cf=bf({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Tf=bf({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kf=bf({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Rf=vf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xf=vf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Pf=bf({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Df=bf({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Of=bf({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Nf=bf({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Bf(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}("".concat(e,":trace"));return cf().enabled("".concat(e,":trace"))&&null!=cf().names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=cf()("".concat(e,":trace"))),Object.assign(cf()(e),{error:cf()("".concat(e,":error")),trace:t})}cf().formatters.b=e=>null==e?"undefined":Rf.baseEncode(e),cf().formatters.t=e=>null==e?"undefined":wf.baseEncode(e),cf().formatters.m=e=>null==e?"undefined":Pf.baseEncode(e),cf().formatters.p=e=>null==e?"undefined":e.toString(),cf().formatters.c=e=>null==e?"undefined":e.toString(),cf().formatters.k=e=>null==e?"undefined":e.toString(),cf().formatters.a=e=>null==e?"undefined":e.toString();const Lf=Symbol.for("@libp2p/peer-id");const Mf=vf({prefix:"9",name:"base10",alphabet:"0123456789"}),Uf=bf({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ff=bf({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Kf=bf({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),jf=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Zf=jf.reduce(((e,t,n)=>(e[n]=t,e)),[]),zf=jf.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const Vf=mf({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Zf[t]),"")},decode:function(e){const t=[];for(const n of e){const e=zf[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),Hf=vf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qf=vf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Gf=bf({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Wf=mf({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Qf=new TextEncoder,Yf=new TextDecoder,Jf="json",Xf=512,$f=e=>Qf.encode(JSON.stringify(e)),ep=e=>JSON.parse(Yf.decode(e)),tp="raw",np=85,rp=e=>hf(e),ip=e=>hf(e);var op=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=cp;)n[r++]=255&t|sp,t/=128;for(;t&ap;)n[r++]=255&t|sp,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},sp=128,ap=-128,cp=Math.pow(2,31);var lp=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&hp)<<o:(r&hp)*Math.pow(2,o),o+=7}while(r>=up);return e.bytes=s-n,i},up=128,hp=127;var dp=Math.pow(2,7),fp=Math.pow(2,14),pp=Math.pow(2,21),gp=Math.pow(2,28),yp=Math.pow(2,35),mp=Math.pow(2,42),vp=Math.pow(2,49),bp=Math.pow(2,56),wp=Math.pow(2,63);const Ep={encode:op,decode:lp,encodingLength:function(e){return e<dp?1:e<fp?2:e<pp?3:e<gp?4:e<yp?5:e<mp?6:e<vp?7:e<bp?8:e<wp?9:10}},Ap=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[Ep.decode(e,t),Ep.decode.bytes]},Sp=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Ep.encode(e,t,n),t},_p=e=>Ep.encodingLength(e),Ip=(e,t)=>{const n=t.byteLength,r=_p(e),i=r+_p(n),o=new Uint8Array(i+n);return Sp(e,o,0),Sp(n,o,r),o.set(t,i),new Tp(e,n,t,o)},Cp=e=>{const t=hf(e),[n,r]=Ap(t),[i,o]=Ap(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Tp(n,i,s,t)};class Tp{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const kp=hf,Rp={code:0,name:"identity",encode:kp,digest:e=>Ip(0,kp(e))},xp=e=>{let{name:t,code:n,encode:r}=e;return new Pp(t,n,r)};class Pp{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ip(this.code,t):t.then((e=>Ip(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Dp=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Op=xp({name:"sha2-256",code:18,encode:Dp("SHA-256")}),Np=xp({name:"sha2-512",code:19,encode:Dp("SHA-512")}),Bp=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?Kp(n,Mp(e),t||Rf.encoder):jp(n,Mp(e),t||wf.encoder)},Lp=new WeakMap,Mp=e=>{const t=Lp.get(e);if(null==t){const t=new Map;return Lp.set(e,t),t}return t};class Up{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Zp)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==zp)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Up.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Ip(e,t);return Up.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return Up.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return Bp(this,e)}toJSON(){return{"/":Bp(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Up)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Up(e,n,r,i||Vp(e,n,r.bytes))}if(!0===t[Hp]){const{version:e,multihash:n,code:r}=t,i=Cp(n);return Up.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Zp)throw new Error("Version 0 CID must use dag-pb (code: ".concat(Zp,") block encoding"));return new Up(e,t,n,n.bytes);case 1:{const r=Vp(e,t,n.bytes);return new Up(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Up.create(0,Zp,e)}static createV1(e,t){return Up.create(1,e,t)}static decode(e){const[t,n]=Up.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Up.inspectBytes(e),n=t.size-t.multihashSize,r=hf(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new Tp(t.multihashCode,t.digestSize,i,r);return[0===t.version?Up.createV0(o):Up.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Ap(e.subarray(t));return t+=r,n};let r=n(),i=Zp;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=Fp(e,t),i=Up.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Mp(i).set(n,e),i}}const Fp=(e,t)=>{switch(e[0]){case"Q":{const n=t||Rf;return[Rf.prefix,n.decode("".concat(Rf.prefix).concat(e))]}case Rf.prefix:{const n=t||Rf;return[Rf.prefix,n.decode(e)]}case wf.prefix:{const n=t||wf;return[wf.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Kp=(e,t,n)=>{const{prefix:r}=n;if(r!==Rf.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},jp=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},Zp=112,zp=18,Vp=(e,t,n)=>{const r=_p(e),i=r+_p(t),o=new Uint8Array(i+n.byteLength);return Sp(e,o,0),Sp(t,o,r),o.set(n,i),o},Hp=Symbol.for("@ipld/js-cid/CID"),qp={...y,...d,...g,...u,...h,...a,...p,...c,...l,...f};let Gp;const Wp=Symbol.for("nodejs.util.inspect.custom"),Qp=Object.values(qp).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),qp.identity.decoder),Yp=114,Jp=36,Xp=37;Gp=Symbol.toStringTag;class $p{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,Lf,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Gp](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=Rf.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Up.createV1(Yp,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return rg(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Wp](){return"PeerId(".concat(this.toString(),")")}}class eg extends $p{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class tg extends $p{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class ng extends $p{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function rg(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:Qp,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Cp(Rf.decode("z".concat(e)));return e.startsWith("12D")?new tg({multihash:t}):e.startsWith("16U")?new ng({multihash:t}):new eg({multihash:t})}return ig(Qp.decode(e))}function ig(e){try{const t=Cp(e);if(t.code===Rp.code){if(t.digest.length===Jp)return new tg({multihash:t});if(t.digest.length===Xp)return new ng({multihash:t})}if(t.code===Op.code)return new eg({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Yp)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Op.code)return new eg({multihash:e.multihash});if(t.code===Rp.code){if(t.digest.length===Jp)return new tg({multihash:e.multihash});if(t.digest.length===Xp)return new ng({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Up.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var og=n(95321);function sg(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)}for(const i of e){if(!0===(null===i||void 0===i?void 0:i.aborted)){n();break}null!=(null===i||void 0===i?void 0:i.addEventListener)&&i.addEventListener("abort",n)}const r=t.signal;return r.clear=function(){for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)},r}var ag=n(75584);const cg=32,lg=64,ug=32;function hg(e,t){const n=new Uint8Array(lg);for(let r=0;r<ug;r++)n[r]=e[r],n[ug+r]=t[r];return n}const dg={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},fg={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function pg(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=dg.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",fg,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",fg,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",fg,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return Pf.encode(r)}var gg,yg,mg,vg;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(gg||(gg={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(yg||(yg={})),function(e){e.codec=()=>bs(yg)}(gg||(gg={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),gg.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=gg.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(mg||(mg={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),gg.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=gg.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(vg||(vg={}));class bg{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=Ig(e,cg)}async verify(e,t){return async function(e,t,n){return Gl.verify(t,n,e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return mg.encode({Type:gg.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}}class wg{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=Ig(e,lg),this._publicKey=Ig(t,cg)}async sign(e){return async function(e,t){const n=e.subarray(0,ug);return Gl.sign(t,n)}(this._key,e)}get public(){return new bg(this._publicKey)}marshal(){return this._key}get bytes(){return vg.encode({Type:gg.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}async id(){const e=Rp.digest(this.public.bytes);return Rf.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return pg(this.bytes,e);throw new tf("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Eg(e){if(e.length>lg){const t=(e=Ig(e,lg+cg)).subarray(0,lg),n=e.subarray(lg,e.length);return new wg(t,n)}const t=(e=Ig(e,lg)).subarray(0,lg),n=e.subarray(cg);return new wg(t,n)}function Ag(e){return e=Ig(e,cg),new bg(e)}async function Sg(){const{privateKey:e,publicKey:t}=await async function(){const e=Gl.utils.randomPrivateKey(),t=Gl.getPublicKey(e);return{privateKey:hg(e,t),publicKey:t}}();return new wg(e,t)}async function _g(e){const{privateKey:t,publicKey:n}=await async function(e){if(e.length!==ug)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=Gl.getPublicKey(t);return{privateKey:hg(t,n),publicKey:n}}(e);return new wg(t,n)}function Ig(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new tf("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}function Cg(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Su.B)(n,"base64url")}function Tg(e){const t=function(e,t){let n=(0,mu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(yu().jsbn.BigInteger)((0,Su.B)(t,"base16"),16)}const kg={"P-256":256,"P-384":384,"P-521":521};Object.keys(kg).join(" / ");function Rg(e,t){return t.map((t=>Tg(e[t])))}async function xg(e){const t=[await dg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Dg(e)],n=await Pg({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function Pg(e){if(null==e.privateKey||null==e.publicKey)throw new tf("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([dg.get().subtle.exportKey("jwk",e.privateKey),dg.get().subtle.exportKey("jwk",e.publicKey)])}async function Dg(e){return dg.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Og(e,t,n,r){const i=t?function(e){return yu().pki.setRsaPublicKey(...Rg(e,["n","e"]))}(e):function(e){return yu().pki.setRsaPrivateKey(...Rg(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Su.B)(Uint8Array.from(n),"ascii"),i);return(0,mu.m)(o,"ascii")}function Ng(e){if("RSA"!==e.kty)throw new tf("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new tf("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,mu.m)(e.n,"base64url").length}const Bg=8192;class Lg{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}async verify(e,t){return async function(e,t,n){const r=await dg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return dg.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n)}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new tf("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.publicKeyToAsn1({n:Tg(e.n),e:Tg(e.e)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return mg.encode({Type:gg.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Og(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}}class Mg{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new tf("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Ic(e)}(16)}async sign(e){return async function(e,t){const n=await dg.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await dg.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,Uint8Array.from(t));return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new tf("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Lg(this._publicKey)}decrypt(e){return Og(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new tf("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.privateKeyToAsn1({n:Tg(e.n),e:Tg(e.e),d:Tg(e.d),p:Tg(e.p),q:Tg(e.q),dP:Tg(e.dp),dQ:Tg(e.dq),qInv:Tg(e.qi)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return vg.encode({Type:gg.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(yu().util.ByteBuffer)(this.marshal()),n=yu().asn1.fromDer(t),r=yu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return yu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return pg(this.bytes,e);throw new tf("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function Ug(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Cg(n.n),e:Cg(n.e),d:Cg(n.d),p:Cg(n.p),q:Cg(n.q),dp:Cg(n.dP),dq:Cg(n.dQ),qi:Cg(n.qInv),alg:"RS256"}}(e);if(Ng(t)>Bg)throw new tf("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await xg(t);return new Mg(n.privateKey,n.publicKey)}function Fg(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Cg(n.n),e:Cg(n.e)}}(e);if(Ng(t)>Bg)throw new tf("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Lg(t)}async function Kg(e){if(Ng(e)>Bg)throw new tf("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await xg(e);return new Mg(t.privateKey,t.publicKey)}async function jg(e){if(e>Bg)throw new tf("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await dg.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await Pg(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new Mg(t.privateKey,t.publicKey)}function Zg(e){try{Ah.ProjectivePoint.fromHex(e)}catch(t){throw new tf(String(t),"ERR_INVALID_PUBLIC_KEY")}}class zg{constructor(e){(0,Yo.Z)(this,"_key",void 0),Zg(e),this._key=e}async verify(e,t){return async function(e,t,n){try{const{digest:r}=await Op.digest(n);return Ah.verify(t,r,e)}catch(r){throw new tf(String(r),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Ah.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return mg.encode({Type:gg.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}}class Vg{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Ah.getPublicKey(e,!0)}catch(t){throw new tf(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Ah.getPublicKey(e,!0)}catch(t){throw new tf(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),Zg(this._publicKey)}async sign(e){return async function(e,t){const{digest:n}=await Op.digest(t);try{return Ah.sign(n,e).toDERRawBytes()}catch(r){throw new tf(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new zg(this._publicKey)}marshal(){return this._key}get bytes(){return vg.encode({Type:gg.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const{bytes:e}=await Op.digest(this.bytes);return e}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return pg(this.bytes,e);throw new tf("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function Hg(e){return new Vg(e)}function qg(e){return new zg(e)}async function Gg(){const e=Ah.utils.randomPrivateKey();return new Vg(e)}const Wg={rsa:A,ed25519:E,secp256k1:S};function Qg(e){const t=Object.keys(Wg).join(" / ");return new tf("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function Yg(e){var t,n;const r=mg.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case gg.RSA:return Wg.rsa.unmarshalRsaPublicKey(i);case gg.Ed25519:return Wg.ed25519.unmarshalEd25519PublicKey(i);case gg.Secp256k1:return Wg.secp256k1.unmarshalSecp256k1PublicKey(i);default:throw Qg(null!==(n=r.Type)&&void 0!==n?n:"unknown")}}let Jg;const Xg="/",$g=(new TextEncoder).encode(Xg);$g[0];Jg=Symbol.toStringTag;var ey,ty=n(92244),ny=n.n(ty);!function(e){let t,n,r;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(n||(n={})),function(e){e.codec=()=>bs(n)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==r&&(r=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signatureV1&&(n.uint32(18),n.bytes(t.signatureV1)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.value=t.bytes();break;case 2:r.signatureV1=t.bytes();break;case 3:r.validityType=e.ValidityType.codec().decode(t);break;case 4:r.validity=t.bytes();break;case 5:r.sequence=t.uint64();break;case 6:r.ttl=t.uint64();break;case 7:r.pubKey=t.bytes();break;case 8:r.signatureV2=t.bytes();break;case 9:r.data=t.bytes();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(ey||(ey={}));const ry=["string","number","bigint","symbol"],iy=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function oy(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(ry.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const n=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(iy.includes(t))return t;return}(e);return n||"Object"}class sy{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return"Type[".concat(this.major,"].").concat(this.name)}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}sy.uint=new sy(0,"uint",!0),sy.negint=new sy(1,"negint",!0),sy.bytes=new sy(2,"bytes",!0),sy.string=new sy(3,"string",!0),sy.array=new sy(4,"array",!1),sy.map=new sy(5,"map",!1),sy.tag=new sy(6,"tag",!1),sy.float=new sy(7,"float",!0),sy.false=new sy(7,"false",!0),sy.true=new sy(7,"true",!0),sy.null=new sy(7,"null",!0),sy.undefined=new sy(7,"undefined",!0),sy.break=new sy(7,"break",!0);class ay{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return"Token[".concat(this.type,"].").concat(this.value)}}const cy=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,ly=new TextDecoder,uy=new TextEncoder;function hy(e){return cy&&globalThis.Buffer.isBuffer(e)}const dy=cy?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):vy(e,t,n):(e,t,n)=>n-t>64?ly.decode(e.subarray(t,n)):vy(e,t,n),fy=cy?e=>e.length>64?globalThis.Buffer.from(e):my(e):e=>e.length>64?uy.encode(e):my(e),py=cy?(e,t,n)=>hy(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),gy=cy?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),function(e){return e instanceof Uint8Array?hy(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let i of e)r+i.length>n.length&&(i=i.subarray(0,n.length-r)),n.set(i,r),r+=i.length;return n},yy=cy?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function my(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function vy(e,t,n){const r=[];for(;t<n;){const i=e[t];let o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=n){let n,r,a,c;switch(s){case 1:i<128&&(o=i);break;case 2:n=e[t+1],128===(192&n)&&(c=(31&i)<<6|63&n,c>127&&(o=c));break;case 3:n=e[t+1],r=e[t+2],128===(192&n)&&128===(192&r)&&(c=(15&i)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),t+=s}return function(e){const t=e.length;if(t<=by)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=by));return n}(r)}const by=4096;const wy="CBOR decode error:",Ey="CBOR encode error:",Ay=[];function Sy(e,t,n){if(e.length-t<n)throw new Error("".concat(wy," not enough data for type"))}Ay[23]=1,Ay[24]=2,Ay[25]=3,Ay[26]=5,Ay[27]=9;const _y=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Iy(e,t,n){Sy(e,t,1);const r=e[t];if(!0===n.strict&&r<_y[0])throw new Error("".concat(wy," integer encoded in more bytes than necessary (strict decode)"));return r}function Cy(e,t,n){Sy(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<_y[1])throw new Error("".concat(wy," integer encoded in more bytes than necessary (strict decode)"));return r}function Ty(e,t,n){Sy(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<_y[2])throw new Error("".concat(wy," integer encoded in more bytes than necessary (strict decode)"));return r}function ky(e,t,n){Sy(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&o<_y[3])throw new Error("".concat(wy," integer encoded in more bytes than necessary (strict decode)"));if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(!0===n.allowBigInt)return o;throw new Error("".concat(wy," integers outside of the safe integer range are not supported"))}function Ry(e,t){return xy(e,0,t.value)}function xy(e,t,n){if(n<_y[0]){const r=Number(n);e.push([t|r])}else if(n<_y[1]){const r=Number(n);e.push([24|t,r])}else if(n<_y[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<_y[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<_y[4]))throw new Error("".concat(wy," encountered BigInt larger than allowable range"));{const n=[27|t,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),o=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&o,o>>=8,n[3]=255&o,o>>=8,n[2]=255&o,o>>=8,n[1]=255&o,e.push(n)}}}Ry.encodedSize=function(e){return xy.encodedSize(e.value)},xy.encodedSize=function(e){return e<_y[0]?1:e<_y[1]?2:e<_y[2]?3:e<_y[3]?5:9},Ry.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Py=BigInt(-1),Dy=BigInt(1);function Oy(e,t){const n=t.value,r="bigint"===typeof n?n*Py-Dy:-1*n-1;xy(e,t.type.majorEncoded,r)}function Ny(e,t,n,r){Sy(e,t,n+r);const i=py(e,t+n,t+n+r);return new ay(sy.bytes,i,n+r)}function By(e,t,n,r){return Ny(e,t,1,n)}function Ly(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===sy.string?fy(e.value):e.value),e.encodedBytes}function My(e,t){const n=Ly(t);xy(e,t.type.majorEncoded,n.length),e.push(n)}function Uy(e,t,n,r,i){const o=n+r;Sy(e,t,o);const s=new ay(sy.string,dy(e,t+n,t+o),o);return!0===i.retainStringBytes&&(s.byteValue=py(e,t+n,t+o)),s}function Fy(e,t,n,r){return Uy(e,t,1,n,r)}Oy.encodedSize=function(e){const t=e.value,n="bigint"===typeof t?t*Py-Dy:-1*t-1;return n<_y[0]?1:n<_y[1]?2:n<_y[2]?3:n<_y[3]?5:9},Oy.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},My.encodedSize=function(e){const t=Ly(e);return xy.encodedSize(t.length)+t.length},My.compareTokens=function(e,t){return n=Ly(e),r=Ly(t),n.length<r.length?-1:n.length>r.length?1:function(e,t){if(hy(e)&&hy(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}(n,r);var n,r};const Ky=My;function jy(e,t,n,r){return new ay(sy.array,r,n)}function Zy(e,t,n,r){return jy(0,0,1,n)}function zy(e,t){xy(e,sy.array.majorEncoded,t.value)}function Vy(e,t,n,r){return new ay(sy.map,r,n)}function Hy(e,t,n,r){return Vy(0,0,1,n)}function qy(e,t){xy(e,sy.map.majorEncoded,t.value)}function Gy(e,t,n,r){return new ay(sy.tag,n,1)}function Wy(e,t){xy(e,sy.tag.majorEncoded,t.value)}zy.compareTokens=Ry.compareTokens,zy.encodedSize=function(e){return xy.encodedSize(e.value)},qy.compareTokens=Ry.compareTokens,qy.encodedSize=function(e){return xy.encodedSize(e.value)},Wy.compareTokens=Ry.compareTokens,Wy.encodedSize=function(e){return xy.encodedSize(e.value)};const Qy=20,Yy=21,Jy=22,Xy=23;function $y(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error("".concat(wy," NaN values are not supported"));if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error("".concat(wy," Infinity values are not supported"))}return new ay(sy.float,e,t)}function em(e,t,n){const r=t.value;if(!1===r)e.push([sy.float.majorEncoded|Qy]);else if(!0===r)e.push([sy.float.majorEncoded|Yy]);else if(null===r)e.push([sy.float.majorEncoded|Jy]);else if(void 0===r)e.push([sy.float.majorEncoded|Xy]);else{let t,o=!1;n&&!0===n.float64||(im(r),t=om(rm,1),r===t||Number.isNaN(r)?(rm[0]=249,e.push(rm.slice(0,3)),o=!0):(sm(r),t=am(rm,1),r===t&&(rm[0]=250,e.push(rm.slice(0,5)),o=!0))),o||(i=r,nm.setFloat64(0,i,!1),t=cm(rm,1),rm[0]=251,e.push(rm.slice(0,9)))}var i}em.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!t||!0!==t.float64){im(n);let e=om(rm,1);if(n===e||Number.isNaN(n))return 3;if(sm(n),e=am(rm,1),n===e)return 5}return 9};const tm=new ArrayBuffer(9),nm=new DataView(tm,1),rm=new Uint8Array(tm,0);function im(e){if(e===1/0)nm.setUint16(0,31744,!1);else if(e===-1/0)nm.setUint16(0,64512,!1);else if(Number.isNaN(e))nm.setUint16(0,32256,!1);else{nm.setFloat32(0,e);const t=nm.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)nm.setUint16(0,31744,!1);else if(0===n)nm.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?nm.setUint16(0,0):e<-14?nm.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):nm.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function om(e,t){if(e.length-t<2)throw new Error("".concat(wy," not enough data for float16"));const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let o;return o=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-o:o}function sm(e){nm.setFloat32(0,e,!1)}function am(e,t){if(e.length-t<4)throw new Error("".concat(wy," not enough data for float32"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function cm(e,t){if(e.length-t<8)throw new Error("".concat(wy," not enough data for float64"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function lm(e,t,n){throw new Error("".concat(wy," encountered invalid minor (").concat(n,") for major ").concat(e[t]>>>5))}function um(e){return()=>{throw new Error("".concat(wy," ").concat(e))}}em.compareTokens=Ry.compareTokens;const hm=[];for(let yye=0;yye<=23;yye++)hm[yye]=lm;hm[24]=function(e,t,n,r){return new ay(sy.uint,Iy(e,t+1,r),2)},hm[25]=function(e,t,n,r){return new ay(sy.uint,Cy(e,t+1,r),3)},hm[26]=function(e,t,n,r){return new ay(sy.uint,Ty(e,t+1,r),5)},hm[27]=function(e,t,n,r){return new ay(sy.uint,ky(e,t+1,r),9)},hm[28]=lm,hm[29]=lm,hm[30]=lm,hm[31]=lm;for(let yye=32;yye<=55;yye++)hm[yye]=lm;hm[56]=function(e,t,n,r){return new ay(sy.negint,-1-Iy(e,t+1,r),2)},hm[57]=function(e,t,n,r){return new ay(sy.negint,-1-Cy(e,t+1,r),3)},hm[58]=function(e,t,n,r){return new ay(sy.negint,-1-Ty(e,t+1,r),5)},hm[59]=function(e,t,n,r){const i=ky(e,t+1,r);if("bigint"!==typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ay(sy.negint,e,9)}if(!0!==r.allowBigInt)throw new Error("".concat(wy," integers outside of the safe integer range are not supported"));return new ay(sy.negint,Py-BigInt(i),9)},hm[60]=lm,hm[61]=lm,hm[62]=lm,hm[63]=lm;for(let yye=64;yye<=87;yye++)hm[yye]=By;hm[88]=function(e,t,n,r){return Ny(e,t,2,Iy(e,t+1,r))},hm[89]=function(e,t,n,r){return Ny(e,t,3,Cy(e,t+1,r))},hm[90]=function(e,t,n,r){return Ny(e,t,5,Ty(e,t+1,r))},hm[91]=function(e,t,n,r){const i=ky(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(wy," 64-bit integer bytes lengths not supported"));return Ny(e,t,9,i)},hm[92]=lm,hm[93]=lm,hm[94]=lm,hm[95]=um("indefinite length bytes/strings are not supported");for(let yye=96;yye<=119;yye++)hm[yye]=Fy;hm[120]=function(e,t,n,r){return Uy(e,t,2,Iy(e,t+1,r),r)},hm[121]=function(e,t,n,r){return Uy(e,t,3,Cy(e,t+1,r),r)},hm[122]=function(e,t,n,r){return Uy(e,t,5,Ty(e,t+1,r),r)},hm[123]=function(e,t,n,r){const i=ky(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(wy," 64-bit integer string lengths not supported"));return Uy(e,t,9,i,r)},hm[124]=lm,hm[125]=lm,hm[126]=lm,hm[127]=um("indefinite length bytes/strings are not supported");for(let yye=128;yye<=151;yye++)hm[yye]=Zy;hm[152]=function(e,t,n,r){return jy(0,0,2,Iy(e,t+1,r))},hm[153]=function(e,t,n,r){return jy(0,0,3,Cy(e,t+1,r))},hm[154]=function(e,t,n,r){return jy(0,0,5,Ty(e,t+1,r))},hm[155]=function(e,t,n,r){const i=ky(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(wy," 64-bit integer array lengths not supported"));return jy(0,0,9,i)},hm[156]=lm,hm[157]=lm,hm[158]=lm,hm[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(wy," indefinite length items not allowed"));return jy(0,0,1,1/0)};for(let yye=160;yye<=183;yye++)hm[yye]=Hy;hm[184]=function(e,t,n,r){return Vy(0,0,2,Iy(e,t+1,r))},hm[185]=function(e,t,n,r){return Vy(0,0,3,Cy(e,t+1,r))},hm[186]=function(e,t,n,r){return Vy(0,0,5,Ty(e,t+1,r))},hm[187]=function(e,t,n,r){const i=ky(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(wy," 64-bit integer map lengths not supported"));return Vy(0,0,9,i)},hm[188]=lm,hm[189]=lm,hm[190]=lm,hm[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(wy," indefinite length items not allowed"));return Vy(0,0,1,1/0)};for(let yye=192;yye<=215;yye++)hm[yye]=Gy;hm[216]=function(e,t,n,r){return new ay(sy.tag,Iy(e,t+1,r),2)},hm[217]=function(e,t,n,r){return new ay(sy.tag,Cy(e,t+1,r),3)},hm[218]=function(e,t,n,r){return new ay(sy.tag,Ty(e,t+1,r),5)},hm[219]=function(e,t,n,r){return new ay(sy.tag,ky(e,t+1,r),9)},hm[220]=lm,hm[221]=lm,hm[222]=lm,hm[223]=lm;for(let yye=224;yye<=243;yye++)hm[yye]=um("simple values are not supported");hm[244]=lm,hm[245]=lm,hm[246]=lm,hm[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw new Error("".concat(wy," undefined values are not supported"));return!0===r.coerceUndefinedToNull?new ay(sy.null,null,1):new ay(sy.undefined,void 0,1)},hm[248]=um("simple values are not supported"),hm[249]=function(e,t,n,r){return $y(om(e,t+1),3,r)},hm[250]=function(e,t,n,r){return $y(am(e,t+1),5,r)},hm[251]=function(e,t,n,r){return $y(cm(e,t+1),9,r)},hm[252]=lm,hm[253]=lm,hm[254]=lm,hm[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(wy," indefinite length items not allowed"));return new ay(sy.break,void 0,1)};const dm=[];for(let yye=0;yye<24;yye++)dm[yye]=new ay(sy.uint,yye,1);for(let yye=-1;yye>=-24;yye--)dm[31-yye]=new ay(sy.negint,yye,1);dm[64]=new ay(sy.bytes,new Uint8Array(0),1),dm[96]=new ay(sy.string,"",1),dm[128]=new ay(sy.array,0,1),dm[160]=new ay(sy.map,0,1),dm[244]=new ay(sy.false,!1,1),dm[245]=new ay(sy.true,!0,1),dm[246]=new ay(sy.null,null,1);(function(){const e=[];e[sy.uint.major]=Ry,e[sy.negint.major]=Oy,e[sy.bytes.major]=My,e[sy.string.major]=Ky,e[sy.array.major]=zy,e[sy.map.major]=qy,e[sy.tag.major]=Wy,e[sy.float.major]=em})(),new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=yy(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1===this.chunks.length){const n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=py(n,0,this.cursor)}else e=gy(this.chunks,this.cursor);return t&&this.reset(),e}};class fm{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error("".concat(Ey," object contains circular references"));return new fm(t,e)}}const pm={null:new ay(sy.null,null),undefined:new ay(sy.undefined,void 0),true:new ay(sy.true,!0),false:new ay(sy.false,!1),emptyArray:new ay(sy.array,0),emptyMap:new ay(sy.map,0)},gm={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ay(e>=0?sy.uint:sy.negint,e):new ay(sy.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new ay(sy.uint,e):new ay(sy.negint,e),Uint8Array:(e,t,n,r)=>new ay(sy.bytes,e),string:(e,t,n,r)=>new ay(sy.string,e),boolean:(e,t,n,r)=>e?pm.true:pm.false,null:(e,t,n,r)=>pm.null,undefined:(e,t,n,r)=>pm.undefined,ArrayBuffer:(e,t,n,r)=>new ay(sy.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new ay(sy.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[pm.emptyArray,new ay(sy.break)]:pm.emptyArray;r=fm.createCheck(r,e);const i=[];let o=0;for(const s of e)i[o++]=ym(s,n,r);return n.addBreakTokens?[new ay(sy.array,e.length),i,new ay(sy.break)]:[new ay(sy.array,e.length),i]},Object(e,t,n,r){const i="Object"!==t,o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return!0===n.addBreakTokens?[pm.emptyMap,new ay(sy.break)]:pm.emptyMap;r=fm.createCheck(r,e);const a=[];let c=0;for(const l of o)a[c++]=[ym(l,n,r),ym(i?e.get(l):e[l],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,n),n.addBreakTokens?[new ay(sy.map,s),a,new ay(sy.break)]:[new ay(sy.map,s),a]}};gm.Map=gm.Object,gm.Buffer=gm.Uint8Array;for(const yye of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))gm["".concat(yye,"Array")]=gm.DataView;function ym(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=oy(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||gm[r];if("function"===typeof i){const o=i(e,r,t,n);if(null!=o)return o}const o=gm[r];if(!o)throw new Error("".concat(Ey," unsupported type: ").concat(r));return o(e,r,t,n)}const mm={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class vm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=dm[e];if(void 0===t){const n=hm[e];if(!n)throw new Error("".concat(wy," no decoder for major type ").concat(e>>>5," (byte 0x").concat(e.toString(16).padStart(2,"0"),")"));const r=31&e;t=n(this.data,this._pos,r,this.options)}return this._pos+=t.encodedLength,t}}const bm=Symbol.for("DONE"),wm=Symbol.for("BREAK");function Em(e,t){if(e.done())return bm;const n=e.next();if(n.type===sy.break)return wm;if(n.type.terminal)return n.value;if(n.type===sy.array)return function(e,t,n){const r=[];for(let i=0;i<e.value;i++){const o=Em(t,n);if(o===wm){if(e.value===1/0)break;throw new Error("".concat(wy," got unexpected break to lengthed array"))}if(o===bm)throw new Error("".concat(wy," found array but not enough entries (got ").concat(i,", expected ").concat(e.value,")"));r[i]=o}return r}(n,e,t);if(n.type===sy.map)return function(e,t,n){const r=!0===n.useMaps,i=r?void 0:{},o=r?new Map:void 0;for(let s=0;s<e.value;s++){const a=Em(t,n);if(a===wm){if(e.value===1/0)break;throw new Error("".concat(wy," got unexpected break to lengthed map"))}if(a===bm)throw new Error("".concat(wy," found map but not enough entries (got ").concat(s," [no key], expected ").concat(e.value,")"));if(!0!==r&&"string"!==typeof a)throw new Error("".concat(wy," non-string keys not supported (got ").concat(typeof a,")"));if(!0===n.rejectDuplicateMapKeys&&(r&&o.has(a)||!r&&a in i))throw new Error("".concat(wy,' found repeat map key "').concat(a,'"'));const c=Em(t,n);if(c===bm)throw new Error("".concat(wy," found map but not enough entries (got ").concat(s," [no value], expected ").concat(e.value,")"));r?o.set(a,c):i[a]=c}return r?o:i}(n,e,t);if(n.type===sy.tag){if(t.tags&&"function"===typeof t.tags[n.value]){const r=Em(e,t);return t.tags[n.value](r)}throw new Error("".concat(wy," tag not supported (").concat(n.value,")"))}throw new Error("unsupported")}function Am(e,t){const[n,r]=function(e,t){if(!(e instanceof Uint8Array))throw new Error("".concat(wy," data to decode must be a Uint8Array"));const n=(t=Object.assign({},mm,t)).tokenizer||new vm(e,t),r=Em(n,t);if(r===bm)throw new Error("".concat(wy," did not find any content to decode"));if(r===wm)throw new Error("".concat(wy," got unexpected break"));return[r,e.subarray(n.pos())]}(e,t);if(r.length>0)throw new Error("".concat(wy," too many terminals, data makes no sense"));return n}const Sm="ERR_UNRECOGNIZED_VALIDITY",_m="ERR_SIGNATURE_VERIFICATION",Im="ERR_UNRECOGNIZED_FORMAT",Cm="ERR_UNDEFINED_PARAMETER",Tm=Bf("ipns:utils"),km=(0,mu.m)("/ipns/");const Rm=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw Tm.error(e),Xo()(e,Cm)}let n;if(null!=t.pubKey){try{n=Yg(t.pubKey)}catch(r){throw Tm.error(r),r}if(!(await async function(e,t){return e.length===Jp?new tg({multihash:Ip(Rp.code,e),privateKey:t}):e.length===Xp?new ng({multihash:Ip(Rp.code,e),privateKey:t}):new eg({multihash:await Op.digest(e),publicKey:e,privateKey:t})}(t.pubKey)).equals(e))throw Xo()(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(n=Yg(e.publicKey));if(null!=n)return n;throw Xo()(new Error("no public key is available"),Cm)},xm=e=>"signatureV1"in e?ey.encode({value:(0,mu.m)(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:(0,mu.m)(e.validity.toString()),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):ey.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data});function Pm(e){const t=ey.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw Xo()(new Error("missing data or signatureV2"),_m);const n=Dm(t.data),r=Om(n.Value);let i;try{i=ny().fromDate(function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),i=parseInt(n[2],10)-1,o=parseInt(n[3],10),s=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].padEnd(6,"0").slice(0,3),10);return new Date(Date.UTC(r,i,o,s,a,c,l))}((0,Su.B)(n.Validity)))}catch(o){throw Tm.error("unrecognized validity format (not an rfc3339 format)"),Xo()(new Error("unrecognized validity format (not an rfc3339 format)"),Im)}if(null!=t.value&&null!=t.signatureV1)return Nm(t),{value:r,validityType:ey.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:r,validityType:ey.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const Dm=e=>{const t=Am(e);if(0!==t.ValidityType)throw Xo()(new Error("Unknown validity type"),Sm);return t.ValidityType=ey.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},Om=e=>{if(null!=e){if(null!=(t=e)&&Boolean(t[Lf]))return"/ipns/".concat(e.toCID().toString(Hf));if(e instanceof Uint8Array){const t=(0,Su.B)(e);t.startsWith("/")&&(e=t)}const n=e.toString().trim();if(n.startsWith("/")&&n.length>1)return n;const r=Up.asCID(e);if(null!=r)return 114===r.code?"/ipns/".concat(r.toString(Hf)):"/ipfs/".concat(r.toV1().toString());try{return e instanceof Uint8Array?"/ipfs/".concat(Up.decode(e).toV1().toString()):"/ipfs/".concat(Up.parse(n).toV1().toString())}catch{}}var t;throw Xo()(new Error("Value must be a valid content path starting with /"),"ERR_INVALID_VALUE")},Nm=e=>{var t,n;if(null==e.data)throw Xo()(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const r=Dm(e.data);if(!(0,Ms.f)(r.Value,null!==(t=e.value)&&void 0!==t?t:new Uint8Array(0)))throw Xo()(new Error('Field "value" did not match between protobuf and CBOR'),_m);if(!(0,Ms.f)(r.Validity,null!==(n=e.validity)&&void 0!==n?n:new Uint8Array(0)))throw Xo()(new Error('Field "validity" did not match between protobuf and CBOR'),_m);if(r.ValidityType!==e.validityType)throw Xo()(new Error('Field "validityType" did not match between protobuf and CBOR'),_m);if(r.Sequence!==e.sequence)throw Xo()(new Error('Field "sequence" did not match between protobuf and CBOR'),_m);if(r.TTL!==e.ttl)throw Xo()(new Error('Field "ttl" did not match between protobuf and CBOR'),_m)};Bf("ipns"),Rp.code;const Bm=Bf("ipns:validator"),Lm=async(e,t)=>{const n=Pm(t);let r;try{const t=(e=>{const t=(0,mu.m)("ipns-signature:");return(0,Ls.z)([t,e])})(n.data);r=await e.verify(t,n.signatureV2)}catch(i){r=!1}if(!r)throw Bm.error("record signature verification failed"),Xo()(new Error("record signature verification failed"),_m);if(n.validityType===ey.ValidityType.EOL){if(n.validity.toDate().getTime()<Date.now())throw Bm.error("record has expired"),Xo()(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=n.validityType)throw Bm.error("unrecognized validity type"),Xo()(new Error("unrecognized validity type"),Sm);Bm("ipns record for %b is valid",n.value)};async function Mm(e,t){if(t.byteLength>10240)throw Xo()(new Error("record too large"),"ERR_RECORD_TOO_LARGE");const n=(e=>ig(e.slice(km.length)))(e),r=Pm(t),i=await Rm(n,r);await Lm(i,t)}async function*Um(e){const t=/\r?\n/,n=new TextDecoder("utf8");let r="";for await(let o of e){var i;"string"===typeof o&&(o=(new TextEncoder).encode(o)),r+=n.decode(o,{stream:!0});const e=r.split(t);r=null!==(i=e.pop())&&void 0!==i?i:"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}r+=n.decode(),""!==r&&(yield JSON.parse(r))}var Fm=n(68702);const Km=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};const jm=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};const Zm=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)yield t(n)}();const n=jm(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){yield await o;for await(const e of n)yield t(e)}();const s=t;return function*(){yield o;for(const e of n)yield s(e)}()},zm=(0,mu.m)("/ipns/");function Vm(e){return(0,Ms.f)(e.subarray(0,zm.byteLength),zm)}const Hm=e=>ig(e.slice(zm.length));class qm{constructor(e){(0,Yo.Z)(this,"client",void 0),this.client=e}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*Zm(t.client.getProviders(e,n),(e=>{var t;return{id:e.ID,multiaddrs:null!==(t=e.Addrs)&&void 0!==t?t:[],protocols:[]}}))}()}catch(n){return Promise.reject(n)}}async provide(){}async put(e,t,n){if(!Vm(e))return;const r=Hm(e),i=Pm(t);await this.client.putIPNS(r,i,n)}async get(e,t){if(!Vm(e))throw new tf("Not found","ERR_NOT_FOUND");const n=Hm(e);try{const e=await this.client.getIPNS(n,t);return xm(e)}catch(r){if("ERR_BAD_RESPONSE"===r.code)throw new tf("Not found","ERR_NOT_FOUND");throw r}}}class Gm{constructor(e){(0,Yo.Z)(this,"client",void 0),this.client=e}async findPeer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await Km(this.client.getPeers(e,t));if(null!=n)return{id:n.ID,multiaddrs:n.Addrs,protocols:[]};throw new tf("Not found","ERR_NOT_FOUND")}getClosestPeers(e){try{return async function*(){}()}catch(t){return Promise.reject(t)}}}const Wm=Bf("delegated-routing-v1-http-api-client"),Qm=4,Ym=3e4;var Jm=new WeakSet,Xm=new WeakSet;class $m{constructor(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Jd(this,Xm),Jd(this,Jm),(0,Yo.Z)(this,"started",void 0),(0,Yo.Z)(this,"httpQueue",void 0),(0,Yo.Z)(this,"shutDownController",void 0),(0,Yo.Z)(this,"clientUrl",void 0),(0,Yo.Z)(this,"timeout",void 0),(0,Yo.Z)(this,"contentRouting",void 0),(0,Yo.Z)(this,"peerRouting",void 0),this.started=!1,this.shutDownController=new AbortController,this.httpQueue=new Fm.Z({concurrency:null!==(t=r.concurrentRequests)&&void 0!==t?t:Qm}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=null!==(n=r.timeout)&&void 0!==n?n:Ym,this.contentRouting=new qm(this),this.peerRouting=new Gm(this)}get[$d](){return this.contentRouting}get[sf](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}getProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){Wm("getProviders starts: %c",e);const r=sg([t.shutDownController.signal,n.signal,AbortSignal.timeout(t.timeout)]),i=Ws(),o=Ws();t.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n="".concat(t.clientUrl,"routing/v1/providers/").concat(e.toString()),o={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,o);if(null==s.body)throw new tf("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const n of e.Providers){const e=Xd(t,Jm,ev).call(t,n);null!=e&&(yield e)}}else for await(const e of Um((0,ag.Z)(s.body))){const n=Xd(t,Jm,ev).call(t,e);null!=n&&(yield n)}}catch(s){Wm.error("getProviders errored:",s)}finally{r.clear(),o.resolve(),Wm("getProviders finished: %c",e)}}()}catch(n){return Promise.reject(n)}}getPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){Wm("getPeers starts: %c",e);const r=sg([t.shutDownController.signal,n.signal,AbortSignal.timeout(t.timeout)]),i=Ws(),o=Ws();t.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n="".concat(t.clientUrl,"routing/v1/peers/").concat(e.toCID().toString()),o={headers:{Accept:"application/x-ndjson"},signal:r},s=await fetch(n,o);if(null==s.body)throw new tf("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const n=await s.json();for(const r of n.Peers){const n=Xd(t,Xm,tv).call(t,e,r);null!=n&&(yield n)}}else for await(const r of Um((0,ag.Z)(s.body))){const n=Xd(t,Xm,tv).call(t,e,r);null!=n&&(yield n)}}catch(s){Wm.error("getPeers errored:",s)}finally{r.clear(),o.resolve(),Wm("getPeers finished: %c",e)}}()}catch(n){return Promise.reject(n)}}async getIPNS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Wm("getIPNS starts: %c",e);const n=sg([this.shutDownController.signal,t.signal,AbortSignal.timeout(this.timeout)]),r=Ws(),i=Ws();this.httpQueue.add((async()=>(r.resolve(),i.promise)));try{await r.promise;const t="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString()),i={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:n},o=await fetch(t,i);if(null==o.body)throw new tf("GET ipns response had no body","ERR_BAD_RESPONSE");const s=new Uint8Array(await o.arrayBuffer());return await Mm((e=>(0,Ls.z)([km,e.toBytes()]))(e),s),Pm(s)}finally{n.clear(),i.resolve(),Wm("getIPNS finished: %c",e)}}async putIPNS(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Wm("getIPNS starts: %c",e);const r=sg([this.shutDownController.signal,n.signal,AbortSignal.timeout(this.timeout)]),i=Ws(),o=Ws();this.httpQueue.add((async()=>(i.resolve(),o.promise)));try{await i.promise;const n=xm(t),o="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString()),s={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:n,signal:r};if(200!==(await fetch(o,s)).status)throw new tf("PUT ipns response had status other than 200","ERR_BAD_RESPONSE")}finally{r.clear(),o.resolve(),Wm("getIPNS finished: %c",e)}}}function ev(e){var t;return"peer"===e.Schema?(e.ID=rg(e.ID),e.Addrs=e.Addrs.map(og.HM),e.Protocols=null!==(t=e.Protocols)&&void 0!==t?t:[],e):"bitswap"===e.Schema?{Schema:"peer",ID:rg(e.ID),Addrs:e.Addrs.map(og.HM),Protocols:null!=e.Protocol?[e.Protocol]:[]}:null!=e.ID&&Array.isArray(e.Addrs)?{Schema:"peer",ID:rg(e.ID),Addrs:e.Addrs.map(og.HM),Protocols:Array.isArray(e.Protocols)?e.Protocols:[]}:void 0}function tv(e,t){if("peer"===t.Schema&&(t.ID=rg(t.ID),t.Addrs=t.Addrs.map(og.HM),e.equals(t.ID)))return t}function nv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new $m(new URL(e),t)}var rv=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const iv=rv,ov=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class sv{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class av{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return lv(this,e)}}class cv{constructor(e){this.decoders=e}or(e){return lv(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const lv=(e,t)=>new cv({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class uv{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new sv(e,t,n),this.decoder=new av(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const hv=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new uv(t,n,r,i)},dv=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=iv(r,n);return hv({prefix:t,name:n,encode:i,decode:e=>ov(o(e))})},fv=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return hv({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},pv=dv({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gv=dv({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),yv=dv({prefix:"9",name:"base10",alphabet:"0123456789"}),mv=fv({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vv=fv({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),bv=fv({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),wv=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Ev=wv.reduce(((e,t,n)=>(e[n]=t,e)),[]),Av=wv.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const Sv=hv({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=Ev[t]),"")},decode:function(e){const t=[];for(const n of e){const e=Av[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),_v=fv({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Iv=fv({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cv=fv({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Tv=fv({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kv=fv({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Rv=fv({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xv=fv({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Pv=fv({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Dv=fv({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ov=dv({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nv=dv({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Bv=fv({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lv=fv({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mv=fv({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uv=fv({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Fv=fv({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Kv=hv({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),jv=new TextEncoder,Zv=new TextDecoder,zv="json",Vv=512,Hv=e=>jv.encode(JSON.stringify(e)),qv=e=>JSON.parse(Zv.decode(e)),Gv="raw",Wv=85,Qv=e=>ov(e),Yv=e=>ov(e);var Jv=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=eb;)n[r++]=255&t|Xv,t/=128;for(;t&$v;)n[r++]=255&t|Xv,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},Xv=128,$v=-128,eb=Math.pow(2,31);var tb=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&rb)<<o:(r&rb)*Math.pow(2,o),o+=7}while(r>=nb);return e.bytes=s-n,i},nb=128,rb=127;var ib=Math.pow(2,7),ob=Math.pow(2,14),sb=Math.pow(2,21),ab=Math.pow(2,28),cb=Math.pow(2,35),lb=Math.pow(2,42),ub=Math.pow(2,49),hb=Math.pow(2,56),db=Math.pow(2,63);const fb={encode:Jv,decode:tb,encodingLength:function(e){return e<ib?1:e<ob?2:e<sb?3:e<ab?4:e<cb?5:e<lb?6:e<ub?7:e<hb?8:e<db?9:10}},pb=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[fb.decode(e,t),fb.decode.bytes]},gb=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fb.encode(e,t,n),t},yb=e=>fb.encodingLength(e),mb=(e,t)=>{const n=t.byteLength,r=yb(e),i=r+yb(n),o=new Uint8Array(i+n);return gb(e,o,0),gb(n,o,r),o.set(t,i),new bb(e,n,t,o)},vb=e=>{const t=ov(e),[n,r]=pb(t),[i,o]=pb(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new bb(n,i,s,t)};class bb{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const wb=ov,Eb={code:0,name:"identity",encode:wb,digest:e=>mb(0,wb(e))},Ab=e=>{let{name:t,code:n,encode:r}=e;return new Sb(t,n,r)};class Sb{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?mb(this.code,t):t.then((e=>mb(this.code,e)))}throw Error("Unknown type, must be binary type")}}const _b=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ib=Ab({name:"sha2-256",code:18,encode:_b("SHA-256")}),Cb=Ab({name:"sha2-512",code:19,encode:_b("SHA-512")}),Tb=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?Db(n,Rb(e),t||pv.encoder):Ob(n,Rb(e),t||_v.encoder)},kb=new WeakMap,Rb=e=>{const t=kb.get(e);if(null==t){const t=new Map;return kb.set(e,t),t}return t};class xb{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Nb)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Bb)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return xb.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=mb(e,t);return xb.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return xb.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return Tb(this,e)}toJSON(){return{"/":Tb(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof xb)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new xb(e,n,r,i||Lb(e,n,r.bytes))}if(!0===t[Mb]){const{version:e,multihash:n,code:r}=t,i=vb(n);return xb.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Nb)throw new Error("Version 0 CID must use dag-pb (code: ".concat(Nb,") block encoding"));return new xb(e,t,n,n.bytes);case 1:{const r=Lb(e,t,n.bytes);return new xb(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return xb.create(0,Nb,e)}static createV1(e,t){return xb.create(1,e,t)}static decode(e){const[t,n]=xb.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=xb.inspectBytes(e),n=t.size-t.multihashSize,r=ov(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new bb(t.multihashCode,t.digestSize,i,r);return[0===t.version?xb.createV0(o):xb.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=pb(e.subarray(t));return t+=r,n};let r=n(),i=Nb;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=Pb(e,t),i=xb.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Rb(i).set(n,e),i}}const Pb=(e,t)=>{switch(e[0]){case"Q":{const n=t||pv;return[pv.prefix,n.decode("".concat(pv.prefix).concat(e))]}case pv.prefix:{const n=t||pv;return[pv.prefix,n.decode(e)]}case _v.prefix:{const n=t||_v;return[_v.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Db=(e,t,n)=>{const{prefix:r}=n;if(r!==pv.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},Ob=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},Nb=112,Bb=18,Lb=(e,t,n)=>{const r=yb(e),i=r+yb(t),o=new Uint8Array(i+n.byteLength);return gb(e,o,0),gb(t,o,r),o.set(n,i),o},Mb=Symbol.for("@ipld/js-cid/CID"),Ub={...O,...T,...D,...I,...C,...R,...x,..._,...P,...k};let Fb;const Kb=Symbol.for("nodejs.util.inspect.custom"),jb=Object.values(Ub).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),Ub.identity.decoder),Zb=114,zb=36,Vb=37;Fb=Symbol.toStringTag;class Hb{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,pu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Fb](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=pv.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return xb.createV1(Zb,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return function(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:jb,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=vb(pv.decode("z".concat(e)));return e.startsWith("12D")?new Gb({multihash:t}):e.startsWith("16U")?new Wb({multihash:t}):new qb({multihash:t})}return Qb(jb.decode(e))}(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Kb](){return"PeerId(".concat(this.toString(),")")}}class qb extends Hb{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Gb extends Hb{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class Wb extends Hb{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function Qb(e){try{const t=vb(e);if(t.code===Eb.code){if(t.digest.length===zb)return new Gb({multihash:t});if(t.digest.length===Vb)return new Wb({multihash:t})}if(t.code===Ib.code)return new qb({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Zb)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Ib.code)return new qb({multihash:e.multihash});if(t.code===Eb.code){if(t.digest.length===zb)return new Gb({multihash:e.multihash});if(t.digest.length===Vb)return new Wb({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(xb.decode(e))}throw new Error("Supplied PeerID CID is invalid")}var Yb=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const Jb=Yb,Xb=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class $b{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class ew{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return nw(this,e)}}class tw{constructor(e){this.decoders=e}or(e){return nw(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const nw=(e,t)=>new tw({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class rw{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new $b(e,t,n),this.decoder=new ew(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const iw=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new rw(t,n,r,i)},ow=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=Jb(r,n);return iw({prefix:t,name:n,encode:i,decode:e=>Xb(o(e))})},sw=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return iw({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},aw=ow({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),cw=ow({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var lw=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=dw;)n[r++]=255&t|uw,t/=128;for(;t&hw;)n[r++]=255&t|uw,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},uw=128,hw=-128,dw=Math.pow(2,31);var fw=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&gw)<<o:(r&gw)*Math.pow(2,o),o+=7}while(r>=pw);return e.bytes=s-n,i},pw=128,gw=127;var yw=Math.pow(2,7),mw=Math.pow(2,14),vw=Math.pow(2,21),bw=Math.pow(2,28),ww=Math.pow(2,35),Ew=Math.pow(2,42),Aw=Math.pow(2,49),Sw=Math.pow(2,56),_w=Math.pow(2,63);const Iw={encode:lw,decode:fw,encodingLength:function(e){return e<yw?1:e<mw?2:e<vw?3:e<bw?4:e<ww?5:e<Ew?6:e<Aw?7:e<Sw?8:e<_w?9:10}},Cw=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[Iw.decode(e,t),Iw.decode.bytes]},Tw=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Iw.encode(e,t,n),t},kw=e=>Iw.encodingLength(e),Rw=(e,t)=>{const n=t.byteLength,r=kw(e),i=r+kw(n),o=new Uint8Array(i+n);return Tw(e,o,0),Tw(n,o,r),o.set(t,i),new Pw(e,n,t,o)},xw=e=>{const t=Xb(e),[n,r]=Cw(t),[i,o]=Cw(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Pw(n,i,s,t)};class Pw{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const Dw=Xb,Ow={code:0,name:"identity",encode:Dw,digest:e=>Rw(0,Dw(e))},Nw=e=>{let{name:t,code:n,encode:r}=e;return new Bw(t,n,r)};class Bw{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Rw(this.code,t):t.then((e=>Rw(this.code,e)))}throw Error("Unknown type, must be binary type")}}const Lw=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Mw=Nw({name:"sha2-256",code:18,encode:Lw("SHA-256")}),Uw=Nw({name:"sha2-512",code:19,encode:Lw("SHA-512")});function Fw(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return(0,Su.B)(n,"base64url")}function Kw(e){const t=function(e,t){let n=(0,mu.m)(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=(0,Ls.z)([new Uint8Array(t-n.length),n])}return n}(e);return new(yu().jsbn.BigInteger)((0,Su.B)(t,"base16"),16)}function jw(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}const Zw=32,zw=64,Vw=32;function Hw(e,t){const n=new Uint8Array(zw);for(let r=0;r<Vw;r++)n[r]=e[r],n[Vw+r]=t[r];return n}const qw=sw({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Gw=sw({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ww=sw({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Qw=sw({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Yw={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},Jw={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};async function Xw(e,t){const n=function(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let c=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const l=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=Yw.get();return c*=8,{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(l)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length){o=await f.subtle.importKey("jwk",Jw,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",Jw,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return(0,Ls.z)([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+l),i=e.subarray(h+l),o={name:a,iv:r};let s;if("string"===typeof t&&(t=(0,mu.m)(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",Jw,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:c},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}(),r=await n.encrypt(e,t);return qw.encode(r)}var $w,eE,tE,nE;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}($w||($w={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(eE||(eE={})),function(e){e.codec=()=>bs(eE)}($w||($w={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),$w.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=$w.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(tE||(tE={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),$w.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=$w.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(nE||(nE={}));class rE{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=lE(e,Zw)}verify(e,t){return function(e,t,n){return Gl.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return tE.encode({Type:$w.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Mw.digest(this.bytes);return jw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class iE{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=lE(e,zw),this._publicKey=lE(t,Zw)}sign(e){return function(e,t){const n=e.subarray(0,Vw);return Gl.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new rE(this._publicKey)}marshal(){return this._key}get bytes(){return nE.encode({Type:$w.Ed25519,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=Mw.digest(this.bytes);let t;return jw(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=Ow.digest(this.public.bytes);return aw.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Xw(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function oE(e){if(e.length>zw){const t=(e=lE(e,zw+Zw)).subarray(0,zw),n=e.subarray(zw,e.length);return new iE(t,n)}const t=(e=lE(e,zw)).subarray(0,zw),n=e.subarray(Zw);return new iE(t,n)}function sE(e){return e=lE(e,Zw),new rE(e)}async function aE(){const{privateKey:e,publicKey:t}=function(){const e=Gl.utils.randomPrivateKey(),t=Gl.getPublicKey(e);return{privateKey:Hw(e,t),publicKey:t}}();return new iE(e,t)}async function cE(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==Vw)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=Gl.getPublicKey(t);return{privateKey:Hw(t,n),publicKey:n}}(e);return new iE(t,n)}function lE(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new pu.sv("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}const uE={"P-256":256,"P-384":384,"P-521":521};Object.keys(uE).join(" / ");function hE(e,t){return t.map((t=>Kw(e[t])))}async function dE(e){const t=[await Yw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await pE(e)],n=await fE({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function fE(e){if(null==e.privateKey||null==e.publicKey)throw new pu.sv("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Yw.get().subtle.exportKey("jwk",e.privateKey),Yw.get().subtle.exportKey("jwk",e.publicKey)])}async function pE(e){return Yw.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function gE(e,t,n,r){const i=t?function(e){return yu().pki.setRsaPublicKey(...hE(e,["n","e"]))}(e):function(e){return yu().pki.setRsaPrivateKey(...hE(e,["n","e","d","p","q","dp","dq","qi"]))}(e),o=r((0,Su.B)(n instanceof Uint8Array?n:n.subarray(),"ascii"),i);return(0,mu.m)(o,"ascii")}function yE(e){if("RSA"!==e.kty)throw new pu.sv("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new pu.sv("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*(0,mu.m)(e.n,"base64url").length}const mE=8192;class vE{constructor(e){(0,Yo.Z)(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await Yw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Yw.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new pu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.publicKeyToAsn1({n:Kw(e.n),e:Kw(e.e)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return tE.encode({Type:$w.RSA,Data:this.marshal()}).subarray()}encrypt(e){return gE(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Mw.digest(this.bytes);return jw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class bE{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new pu.sv("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Ic(e)}(16)}sign(e){return async function(e,t){const n=await Yw.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Yw.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new pu.sv("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new vE(this._publicKey)}decrypt(e){return gE(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new pu.sv("JWK was missing components","ERR_INVALID_PARAMETERS");const t=yu().pki.privateKeyToAsn1({n:Kw(e.n),e:Kw(e.e),d:Kw(e.d),p:Kw(e.p),q:Kw(e.q),dP:Kw(e.dp),dQ:Kw(e.dq),qInv:Kw(e.qi)});return(0,mu.m)(yu().asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return nE.encode({Type:$w.RSA,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Mw.digest(this.bytes);return jw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new(yu().util.ByteBuffer)(this.marshal()),n=yu().asn1.fromDer(t),r=yu().pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return yu().pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return Xw(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function wE(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Fw(n.n),e:Fw(n.e),d:Fw(n.d),p:Fw(n.p),q:Fw(n.q),dp:Fw(n.dP),dq:Fw(n.dQ),qi:Fw(n.qInv),alg:"RS256"}}(e);if(yE(t)>mE)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await dE(t);return new bE(n.privateKey,n.publicKey)}function EE(e){const t=function(e){const t=yu().asn1.fromDer((0,Su.B)(e,"ascii")),n=yu().pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Fw(n.n),e:Fw(n.e)}}(e);if(yE(t)>mE)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new vE(t)}async function AE(e){if(yE(e)>mE)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await dE(e);return new bE(t.privateKey,t.publicKey)}async function SE(e){if(e>mE)throw new pu.sv("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Yw.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await fE(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new bE(t.privateKey,t.publicKey)}function _E(e){try{Ah.ProjectivePoint.fromHex(e)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PUBLIC_KEY")}}class IE{constructor(e){(0,Yo.Z)(this,"_key",void 0),_E(e),this._key=e}verify(e,t){return function(e,t,n){const r=Mw.digest(n instanceof Uint8Array?n:n.subarray());if(jw(r))return r.then((n=>{let{digest:r}=n;return Ah.verify(t,r,e)})).catch((e=>{throw new pu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Ah.verify(t,r.digest,e)}catch(i){throw new pu.sv(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,Ah.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return tE.encode({Type:$w.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}async hash(){const e=Mw.digest(this.bytes);let t;return jw(e)?({bytes:t}=await e):t=e.bytes,t}}class CE{constructor(e,t){(0,Yo.Z)(this,"_key",void 0),(0,Yo.Z)(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return Ah.getPublicKey(e,!0)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{Ah.getPublicKey(e,!0)}catch(t){throw new pu.sv(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),_E(this._publicKey)}sign(e){return function(e,t){const n=Mw.digest(t instanceof Uint8Array?t:t.subarray());if(jw(n))return n.then((t=>{let{digest:n}=t;return Ah.sign(n,e).toDERRawBytes()})).catch((e=>{throw new pu.sv(String(e),"ERR_INVALID_INPUT")}));try{return Ah.sign(n.digest,e).toDERRawBytes()}catch(r){throw new pu.sv(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new IE(this._publicKey)}marshal(){return this._key}get bytes(){return nE.encode({Type:$w.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return(0,Ms.f)(this.bytes,e.bytes)}hash(){const e=Mw.digest(this.bytes);return jw(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){const e=await this.public.hash();return(0,Su.B)(e,"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Xw(this.bytes,e);throw new pu.sv("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function TE(e){return new CE(e)}function kE(e){return new IE(e)}async function RE(){const e=Ah.utils.randomPrivateKey();return new CE(e)}const xE={rsa:z,ed25519:Z,secp256k1:V};function PE(e){const t=Object.keys(xE).join(" / ");return new pu.sv("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function DE(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return xE[e];throw PE(e)}const OE=ow({prefix:"9",name:"base10",alphabet:"0123456789"}),NE=sw({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),BE=sw({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),LE=sw({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ME=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),UE=ME.reduce(((e,t,n)=>(e[n]=t,e)),[]),FE=ME.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const KE=iw({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=UE[t]),"")},decode:function(e){const t=[];for(const n of e){const e=FE[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),jE=sw({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ZE=sw({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zE=sw({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),VE=sw({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),HE=sw({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qE=sw({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),GE=sw({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),WE=sw({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),QE=sw({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),YE=ow({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),JE=ow({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),XE=sw({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),$E=iw({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),eA=new TextEncoder,tA=new TextDecoder,nA="json",rA=512,iA=e=>eA.encode(JSON.stringify(e)),oA=e=>JSON.parse(tA.decode(e)),sA="raw",aA=85,cA=e=>Xb(e),lA=e=>Xb(e),uA=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?gA(n,dA(e),t||aw.encoder):yA(n,dA(e),t||jE.encoder)},hA=new WeakMap,dA=e=>{const t=hA.get(e);if(null==t){const t=new Map;return hA.set(e,t),t}return t};class fA{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==mA)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==vA)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return fA.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Rw(e,t);return fA.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return fA.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return uA(this,e)}toJSON(){return{"/":uA(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof fA)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new fA(e,n,r,i||bA(e,n,r.bytes))}if(!0===t[wA]){const{version:e,multihash:n,code:r}=t,i=xw(n);return fA.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==mA)throw new Error("Version 0 CID must use dag-pb (code: ".concat(mA,") block encoding"));return new fA(e,t,n,n.bytes);case 1:{const r=bA(e,t,n.bytes);return new fA(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return fA.create(0,mA,e)}static createV1(e,t){return fA.create(1,e,t)}static decode(e){const[t,n]=fA.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=fA.inspectBytes(e),n=t.size-t.multihashSize,r=Xb(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new Pw(t.multihashCode,t.digestSize,i,r);return[0===t.version?fA.createV0(o):fA.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Cw(e.subarray(t));return t+=r,n};let r=n(),i=mA;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),c=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:c-o,size:c}}static parse(e,t){const[n,r]=pA(e,t),i=fA.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return dA(i).set(n,e),i}}const pA=(e,t)=>{switch(e[0]){case"Q":{const n=t||aw;return[aw.prefix,n.decode("".concat(aw.prefix).concat(e))]}case aw.prefix:{const n=t||aw;return[aw.prefix,n.decode(e)]}case jE.prefix:{const n=t||jE;return[jE.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},gA=(e,t,n)=>{const{prefix:r}=n;if(r!==aw.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},yA=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},mA=112,vA=18,bA=(e,t,n)=>{const r=kw(e),i=r+kw(t),o=new Uint8Array(i+n.byteLength);return Tw(e,o,0),Tw(t,o,r),o.set(n,i),o},wA=Symbol.for("@ipld/js-cid/CID"),EA={...X,...G,...J,...H,...q,...Q,...Y,...U,...j,...W};let AA;const SA=Symbol.for("nodejs.util.inspect.custom"),_A=Object.values(EA).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),EA.identity.decoder),IA=114,CA=36,TA=37;AA=Symbol.toStringTag;class kA{constructor(e){(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"multihash",void 0),(0,Yo.Z)(this,"privateKey",void 0),(0,Yo.Z)(this,"publicKey",void 0),(0,Yo.Z)(this,"string",void 0),(0,Yo.Z)(this,pu.Cs,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[AA](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=aw.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return fA.createV1(IA,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e instanceof Uint8Array)return(0,Ms.f)(this.multihash.bytes,e);if("string"===typeof e)return function(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:_A,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=xw(aw.decode("z".concat(e)));return e.startsWith("12D")?new xA({multihash:t}):e.startsWith("16U")?new PA({multihash:t}):new RA({multihash:t})}return function(e){try{const t=xw(e);if(t.code===Ow.code){if(t.digest.length===CA)return new xA({multihash:t});if(t.digest.length===TA)return new PA({multihash:t})}if(t.code===Mw.code)return new RA({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==IA)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===Mw.code)return new RA({multihash:e.multihash});if(t.code===Ow.code){if(t.digest.length===CA)return new xA({multihash:e.multihash});if(t.digest.length===TA)return new PA({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(fA.decode(e))}throw new Error("Supplied PeerID CID is invalid")}(_A.decode(e))}(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return(0,Ms.f)(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[SA](){return"PeerId(".concat(this.toString(),")")}}class RA extends kA{constructor(e){super({...e,type:"RSA"}),(0,Yo.Z)(this,"type","RSA"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.publicKey}}class xA extends kA{constructor(e){super({...e,type:"Ed25519"}),(0,Yo.Z)(this,"type","Ed25519"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class PA extends kA{constructor(e){super({...e,type:"secp256k1"}),(0,Yo.Z)(this,"type","secp256k1"),(0,Yo.Z)(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}var DA;!function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(DA||(DA={}));const OA=async()=>{const e=await async function(e,t){return DE(e).generateKeyPair(null!==t&&void 0!==t?t:2048)}("Ed25519"),t=await NA(e);if("Ed25519"===t.type)return t;throw new Error('Generated unexpected PeerId type "'.concat(t.type,'"'))};async function NA(e){return async function(e,t){return e.length===CA?new xA({multihash:Rw(Ow.code,e),privateKey:t}):e.length===TA?new PA({multihash:Rw(Ow.code,e),privateKey:t}):new RA({multihash:await Mw.digest(e),publicKey:e,privateKey:t})}(function(e,t){var n;return DE(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}(e.public),function(e,t){var n;return DE(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}(e))}const BA=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t};function LA(e){return null!=e[Symbol.asyncIterator]}const MA=e=>{const t=Bs.P$(e),n=(0,Us.E)(t);return Bs.cv(e,n),MA.bytes=t,n};function UA(e,t){var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:MA;function*o(e){const t=i(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return LA(e)?async function*(){for await(const t of e)yield*o(t)}():function*(){for(const t of e)yield*o(t)}()}MA.bytes=0,UA.single=(e,t)=>{var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:MA;return new Zs(i(e.byteLength),e)};var FA;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(FA||(FA={}));const KA=e=>{const t=Bs.Jx(e);return KA.bytes=Bs.P$(t),t};function jA(e,t){var n,r,i;const o=new Zs;let s=FA.LENGTH,a=-1;const c=null!==(n=null===t||void 0===t?void 0:t.lengthDecoder)&&void 0!==n?n:KA,l=null!==(r=null===t||void 0===t?void 0:t.maxLengthLength)&&void 0!==r?r:8,u=null!==(i=null===t||void 0===t?void 0:t.maxDataLength)&&void 0!==i?i:4194304;function*h(){for(;o.byteLength>0;){if(s===FA.LENGTH)try{if(a=c(o),a<0)throw Xo()(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(a>u)throw Xo()(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const e=c.bytes;o.consume(e),null!=(null===t||void 0===t?void 0:t.onLength)&&t.onLength(a),s=FA.DATA}catch(e){if(e instanceof RangeError){if(o.byteLength>l)throw Xo()(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(s===FA.DATA){if(o.byteLength<a)break;const e=o.sublist(0,a);o.consume(a),null!=(null===t||void 0===t?void 0:t.onData)&&t.onData(e),yield e,s=FA.LENGTH}}}return LA(e)?async function*(){for await(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw Xo()(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw Xo()(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}KA.bytes=0,jA.fromReader=(e,t)=>{let n=1;return jA(async function*(){for(;;)try{const{done:t,value:r}=await e.next(n);if(!0===t)return;null!=r&&(yield r)}catch(t){if("ERR_UNDER_READ"===t.code)return{done:!0,value:null};throw t}finally{n=1}}(),{...null!==t&&void 0!==t?t:{},onLength:e=>{n=e}})};const ZA=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};const zA=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)yield t(n)}();const n=ZA(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){yield await o;for await(const e of n)yield t(e)}();const s=t;return function*(){yield o;for(const e of n)yield s(e)}()};var VA;const HA=null!==(VA=globalThis.CustomEvent)&&void 0!==VA?VA:Event;function qA(e){try{let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(n){let r=null!==(n=t.concurrency)&&void 0!==n?n:1/0;r<1&&(r=1/0);const i=null!=t.ordered&&t.ordered,o=new EventTarget,s=[];let a,c=Ws(),l=Ws(),u=!1,h=!1;function d(){var e;return i?null===(e=s[0])||void 0===e?void 0:e.done:Boolean(s.find((e=>e.done)))}function*f(){for(;s.length>0&&s[0].done;){const e=s[0];if(s.shift(),!e.ok)throw h=!0,c.resolve(),e.err;yield e.value,c.resolve()}}function*p(){for(;d();)for(let e=0;e<s.length;e++)if(s[e].done){const t=s[e];if(s.splice(e,1),e--,!t.ok)throw h=!0,c.resolve(),t.err;yield t.value,c.resolve()}}for(o.addEventListener("task-complete",(()=>{l.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(s.length===r&&(c=Ws(),await c.promise),h)break;const e={done:!1};s.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new HA("task-complete"))}),(t=>{e.done=!0,e.err=t,o.dispatchEvent(new HA("task-complete"))}))}u=!0,o.dispatchEvent(new HA("task-complete"))}catch(t){a=t,o.dispatchEvent(new HA("task-complete"))}}));;){if(d()||(l=Ws(),await l.promise),null!=a)throw a;if(i?yield*f():yield*p(),u&&0===s.length)break}}()}catch(t){return Promise.reject(t)}}class GA{constructor(e){if((0,Yo.Z)(this,"buffer",void 0),(0,Yo.Z)(this,"mask",void 0),(0,Yo.Z)(this,"top",void 0),(0,Yo.Z)(this,"btm",void 0),(0,Yo.Z)(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class WA{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Yo.Z)(this,"size",void 0),(0,Yo.Z)(this,"hwm",void 0),(0,Yo.Z)(this,"head",void 0),(0,Yo.Z)(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new GA(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new GA(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class QA extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),(0,Yo.Z)(this,"type",void 0),(0,Yo.Z)(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function YA(){return JA((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function JA(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new WA,c=Ws();const l=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new WA,null!=i?i({error:e}):(a.push({error:e}),r)))(e):l({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{c.resolve(),c=Ws()}))}},return:()=>(a=new WA,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new QA)},t.addEventListener("abort",r)})));try{await Promise.race([c.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}const XA=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[];for(const i of t)null==i[Symbol.asyncIterator]&&r.push(i);return r.length===t.length?function*(){for(const e of r)yield*e}():async function*(){const e=YA({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(t.map((async t=>{for await(const n of t)e.push(n)}))),e.end()}catch(n){e.end(n)}})),yield*e}()};function $A(e){if(null==e)throw new Error("Empty pipeline");if(rS(e)){const t=e;e=()=>t.source}else if(nS(e)||tS(e)){const t=e;e=()=>t}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=[e,...n];if(i.length>1&&rS(i[i.length-1])&&(i[i.length-1]=i[i.length-1].sink),i.length>2)for(let o=1;o<i.length-1;o++)rS(i[o])&&(i[o]=iS(i[o]));return eS(...i)}const eS=function(){let e;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(;n.length>0;)e=n.shift()(e);return e},tS=e=>null!=(null===e||void 0===e?void 0:e[Symbol.asyncIterator]),nS=e=>null!=(null===e||void 0===e?void 0:e[Symbol.iterator]),rS=e=>null!=e&&(null!=e.sink&&null!=e.source),iS=e=>t=>{const n=e.sink(t);if(null!=(null===n||void 0===n?void 0:n.then)){const t=YA({objectMode:!0});let r;n.then((()=>{t.end()}),(e=>{t.end(e)}));const i=e.source;if(tS(i))r=async function*(){yield*i,t.end()};else{if(!nS(i))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");r=function*(){yield*i,t.end()}}return XA(t,r())}return e.source};var oS=n(27922);const sS="[a-fA-F\\d:]",aS=e=>e&&e.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(sS,")|(?<=").concat(sS,")(?=\\s|$))"):"",cS="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",lS="[a-fA-F\\d]{1,4}",uS="\n(?:\n(?:".concat(lS,":){7}(?:").concat(lS,"|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:").concat(lS,":){6}(?:").concat(cS,"|:").concat(lS,"|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:").concat(lS,":){5}(?::").concat(cS,"|(?::").concat(lS,"){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:").concat(lS,":){4}(?:(?::").concat(lS,"){0,1}:").concat(cS,"|(?::").concat(lS,"){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:").concat(lS,":){3}(?:(?::").concat(lS,"){0,2}:").concat(cS,"|(?::").concat(lS,"){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:").concat(lS,":){2}(?:(?::").concat(lS,"){0,3}:").concat(cS,"|(?::").concat(lS,"){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:").concat(lS,":){1}(?:(?::").concat(lS,"){0,4}:").concat(cS,"|(?::").concat(lS,"){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::").concat(lS,"){0,5}:").concat(cS,"|(?::").concat(lS,"){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),hS=new RegExp("(?:^".concat(cS,"$)|(?:^").concat(uS,"$)")),dS=new RegExp("^".concat(cS,"$")),fS=new RegExp("^".concat(uS,"$")),pS=e=>e&&e.exact?hS:new RegExp("(?:".concat(aS(e)).concat(cS).concat(aS(e),")|(?:").concat(aS(e)).concat(uS).concat(aS(e),")"),"g");pS.v4=e=>e&&e.exact?dS:new RegExp("".concat(aS(e)).concat(cS).concat(aS(e)),"g"),pS.v6=e=>e&&e.exact?fS:new RegExp("".concat(aS(e)).concat(uS).concat(aS(e)),"g");const gS=pS;var yS=n(54636),mS=n(87201),vS=n.n(mS);const{isValid:bS,parse:wS}=vS(),ES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((e=>new oS.Netmask(e)));function AS(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}const SS=e=>{if(bS(e)){const t=wS(e);if("ipv4"===t.kind())return function(e){for(let t of ES)if(t.contains(e))return!0;return!1}(t.toNormalizedString());if("ipv6"===t.kind())return AS(e)}else if((0,yS.h6)(e)&&gS.v6().test(e))return AS(e)};var _S;!function(e){let t,n,r,i,o,s,a,c;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(n||(n={})),function(e){e.codec=()=>bs(n)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>bs(i)}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=ws((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(o=e.PeerInfo||(e.PeerInfo={})),function(t){let n;t.codec=()=>(null==n&&(n=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.peer&&(n.uint32(10),e.PeerInfo.codec().encode(t.peer,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();if(n>>>3===1)r.peer=e.PeerInfo.codec().decode(t,t.uint32());else t.skipType(7&n)}return r}))),n),t.encode=e=>fs(e,t.codec()),t.decode=e=>ds(e,t.codec())}(s=e.Dial||(e.Dial={})),function(t){let n;t.codec=()=>(null==n&&(n=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.status&&(n.uint32(8),e.ResponseStatus.codec().encode(t.status,n)),null!=t.statusText&&(n.uint32(18),n.string(t.statusText)),null!=t.addr&&(n.uint32(26),n.bytes(t.addr)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.status=e.ResponseStatus.codec().decode(t);break;case 2:r.statusText=t.string();break;case 3:r.addr=t.bytes();break;default:t.skipType(7&n)}}return r}))),n),t.encode=e=>fs(e,t.codec()),t.decode=e=>ds(e,t.codec())}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==c&&(c=ws((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.MessageType.codec().encode(t.type,n)),null!=t.dial&&(n.uint32(18),e.Dial.codec().encode(t.dial,n)),null!=t.dialResponse&&(n.uint32(26),e.DialResponse.codec().encode(t.dialResponse,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.MessageType.codec().decode(t);break;case 2:r.dial=e.Dial.codec().decode(t,t.uint32());break;case 3:r.dialResponse=e.DialResponse.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return r}))),c),e.encode=t=>fs(t,e.codec()),e.decode=t=>ds(t,e.codec())}(_S||(_S={}));class IS{constructor(e,t){var n,r,i,o,s,a;(0,Yo.Z)(this,"components",void 0),(0,Yo.Z)(this,"startupDelay",void 0),(0,Yo.Z)(this,"refreshInterval",void 0),(0,Yo.Z)(this,"protocol",void 0),(0,Yo.Z)(this,"timeout",void 0),(0,Yo.Z)(this,"maxInboundStreams",void 0),(0,Yo.Z)(this,"maxOutboundStreams",void 0),(0,Yo.Z)(this,"verifyAddressTimeout",void 0),(0,Yo.Z)(this,"started",void 0),(0,Yo.Z)(this,"log",void 0),this.components=e,this.log=e.logger.forComponent("libp2p:autonat"),this.started=!1,this.protocol="/".concat(null!==(n=t.protocolPrefix)&&void 0!==n?n:"libp2p","/").concat("autonat","/").concat("1.0.0"),this.timeout=null!==(r=t.timeout)&&void 0!==r?r:3e4,this.maxInboundStreams=null!==(i=t.maxInboundStreams)&&void 0!==i?i:1,this.maxOutboundStreams=null!==(o=t.maxOutboundStreams)&&void 0!==o?o:1,this.startupDelay=null!==(s=t.startupDelay)&&void 0!==s?s:5e3,this.refreshInterval=null!==(a=t.refreshInterval)&&void 0!==a?a:6e4,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(e=>{this.handleIncomingAutonatStream(e).catch((e=>{this.log.error("error handling incoming autonat stream",e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=()=>{e.stream.abort(new pu.sv("handleIncomingAutonatStream timeout",pu.l9))};t.addEventListener("abort",n,{once:!0}),(0,pu.Wp)(1/0,t);const r=this.components.addressManager.getAddresses().map((e=>e.toOptions().host));try{const n=this;await $A(e.stream,(e=>jA(e)),(async function*(i){const o=await BA(i);if(null==o)return n.log("no message received"),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}}));let s;try{s=_S.decode(o)}catch(f){return n.log.error("could not decode message",f),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}}))}const a=s.dial;if(null==a)return n.log.error("dial was missing from message"),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}}));let c;const l=a.peer;if(null==l||null==l.id)return n.log.error("PeerId missing from message"),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}}));try{c=Qb(l.id)}catch(f){return n.log.error("invalid PeerId",f),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}))}if(n.log("incoming request from %p",c),!e.connection.remotePeer.equals(c))return n.log("target peer %p did not equal sending peer %p",c,e.connection.remotePeer),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}}));const u=l.addrs.map((e=>(0,og.HM)(e))).filter((t=>{const r=t.toOptions().host===e.connection.remoteAddr.toOptions().host;return n.log.trace("request to dial %a was sent from %a is same host %s",t,e.connection.remoteAddr,r),r})).filter((e=>{var t;const r=e.toOptions().host,i=!(null!==(t=SS(r))&&void 0!==t&&t);return n.log.trace("host %s was public %s",r,i),i})).filter((e=>{const t=e.toOptions().host,i=!r.includes(t);return n.log.trace("host %s was not our host %s",t,i),i})).filter((e=>{const t=Boolean(n.components.transportManager.transportForMultiaddr(e));return n.log.trace("transport for %a is supported %s",e,t),t})).map((e=>(null==e.getPeerId()&&(e=e.encapsulate("/p2p/".concat(c.toString()))),e)));if(0===u.length)return n.log("no valid multiaddrs for %p in message",c),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}}));n.log("dial multiaddrs %s for peer %p",u.map((e=>e.toString())).join(", "),c);let h="",d=u[0];for await(const e of u){let r;d=e;try{if(r=await n.components.connectionManager.openConnection(e,{signal:t}),!r.remoteAddr.equals(e))throw n.log.error("tried to dial %a but dialed %a",e,r.remoteAddr),new Error("Unexpected remote address");return n.log("Success %p",c),void(yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.OK,addr:r.remoteAddr.decapsulateCode((0,og.a_)("p2p").code).bytes}}))}catch(f){n.log("could not dial %p",c,f),h=f.message}finally{null!=r&&await r.close()}}yield _S.encode({type:_S.MessageType.DIAL_RESPONSE,dialResponse:{status:_S.ResponseStatus.E_DIAL_ERROR,statusText:h,addr:d.bytes}})}),(e=>UA(e)),e.stream)}catch(i){this.log.error("error handling incoming autonat stream",i)}finally{t.removeEventListener("abort",n)}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch((e=>{this.log.error("error verifying external address",e)}))}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;const e=this.components.addressManager,t=e.getObservedAddrs().filter((e=>{var t;const n=e.toOptions();return!(null!==(t=SS(n.host))&&void 0!==t&&t)}));if(0===t.length)return this.log("no public addresses found, not requesting verification"),void(this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval));const n=AbortSignal.timeout(this.timeout);(0,pu.Wp)(1/0,n);const r=this;try{this.log("verify multiaddrs %s",t.map((e=>e.toString())).join(", "));const o=_S.encode({type:_S.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:t.map((e=>e.bytes))}}}),s=(await OA()).toBytes(),a={},c=[],l=async e=>{let t=()=>{};try{this.log("asking %p to verify multiaddr",e.id);const i=await r.components.connectionManager.openConnection(e.id,{signal:n}),s=await i.newStream(this.protocol,{signal:n});t=()=>{s.abort(new pu.sv("verifyAddress timeout",pu.l9))},n.addEventListener("abort",t,{once:!0});const a=await $A([o],(e=>UA(e)),s,(e=>jA(e)),(async e=>BA(e)));if(null==a)return void this.log("no response received from %p",i.remotePeer);const l=_S.decode(a);if(l.type!==_S.MessageType.DIAL_RESPONSE||null==l.dialResponse)return void this.log("invalid autonat response from %p",i.remotePeer);if(l.dialResponse.status===_S.ResponseStatus.OK){const e=i.remoteAddr.toOptions();let t;if(4===e.family){t=e.host.split(".")[0]}else{if(6!==e.family)return void this.log('remote address "%s" was not IP4 or IP6?',e.host);t=e.host.split(":")[0]}if(c.includes(t))return void this.log("already have response from network segment %d - %s",t,e.host);c.push(t)}return l.dialResponse}catch(i){this.log.error("error asking remote to verify multiaddr",i)}finally{n.removeEventListener("abort",t)}};for await(const r of qA(zA(this.components.peerRouting.getClosestPeers(s,{signal:n}),(e=>async()=>l(e))),{concurrency:4}))try{if(null==r)continue;const n=null==r.addr?t[0]:(0,og.HM)(r.addr);if(this.log("autonat response for %a is %s",n,r.status),r.status===_S.ResponseStatus.E_BAD_REQUEST)continue;if(r.status===_S.ResponseStatus.E_DIAL_REFUSED)continue;if(null==r.addr&&t.length>1)continue;if(!t.some((e=>e.equals(n)))){this.log("peer reported %a as %s but it was not in our observed address list",n,r.status);continue}const i=n.toString();if(null==a[i]&&(a[i]={success:0,failure:0}),r.status===_S.ResponseStatus.OK?a[i].success++:r.status===_S.ResponseStatus.E_DIAL_ERROR&&a[i].failure++,4===a[i].success)return this.log("%a is externally dialable",n),void e.confirmObservedAddr(n);if(4===a[i].failure)return this.log("%a is not externally dialable",n),void e.removeObservedAddr(n)}catch(i){this.log.error("could not verify external address",i)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function CS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new IS(t,e)}var TS=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===c;)r++,t++;for(var o=(e.length-t)*l+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,l=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===l[p];)p++;for(var g=c.repeat(n);p<s;++p)g+=e.charAt(l[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const kS=TS,RS=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class xS{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class PS{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return OS(this,e)}}class DS{constructor(e){this.decoders=e}or(e){return OS(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const OS=(e,t)=>new DS({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class NS{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new xS(e,t,n),this.decoder=new PS(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const BS=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new NS(t,n,r,i)},LS=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=kS(r,n);return BS({prefix:t,name:n,encode:i,decode:e=>RS(o(e))})},MS=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return BS({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,c=0,l=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));c=c<<n|t,a+=n,a>=8&&(a-=8,s[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},US=LS({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),FS=LS({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),KS=LS({prefix:"9",name:"base10",alphabet:"0123456789"}),jS=MS({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ZS=MS({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),zS=MS({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),VS=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),HS=VS.reduce(((e,t,n)=>(e[n]=t,e)),[]),qS=VS.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const GS=BS({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=HS[t]),"")},decode:function(e){const t=[];for(const n of e){const e=qS[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),WS=MS({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),QS=MS({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),YS=MS({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),JS=MS({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),XS=MS({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$S=MS({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),e_=MS({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),t_=MS({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),n_=MS({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),r_=LS({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i_=LS({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),o_=MS({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s_=MS({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),a_=MS({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),c_=MS({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),l_=MS({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),u_=BS({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),h_=new TextEncoder,d_=new TextDecoder,f_="json",p_=512,g_=e=>h_.encode(JSON.stringify(e)),y_=e=>JSON.parse(d_.decode(e)),m_="raw",v_=85,b_=e=>RS(e),w_=e=>RS(e);var E_=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=__;)n[r++]=255&t|A_,t/=128;for(;t&S_;)n[r++]=255&t|A_,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},A_=128,S_=-128,__=Math.pow(2,31);var I_=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&T_)<<o:(r&T_)*Math.pow(2,o),o+=7}while(r>=C_);return e.bytes=s-n,i},C_=128,T_=127;var k_=Math.pow(2,7),R_=Math.pow(2,14),x_=Math.pow(2,21),P_=Math.pow(2,28),D_=Math.pow(2,35),O_=Math.pow(2,42),N_=Math.pow(2,49),B_=Math.pow(2,56),L_=Math.pow(2,63);const M_={encode:E_,decode:I_,encodingLength:function(e){return e<k_?1:e<R_?2:e<x_?3:e<P_?4:e<D_?5:e<O_?6:e<N_?7:e<B_?8:e<L_?9:10}},U_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[M_.decode(e,t),M_.decode.bytes]},F_=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return M_.encode(e,t,n),t},K_=e=>M_.encodingLength(e),j_=(e,t)=>{const n=t.byteLength,r=K_(e),i=r+K_(n),o=new Uint8Array(i+n);return F_(e,o,0),F_(n,o,r),o.set(t,i),new z_(e,n,t,o)},Z_=e=>{const t=RS(e),[n,r]=U_(t),[i,o]=U_(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new z_(n,i,s,t)};class z_{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const V_=RS,H_={code:0,name:"identity",encode:V_,digest:e=>j_(0,V_(e))},q_=e=>{let{name:t,code:n,encode:r}=e;return new G_(t,n,r)};class G_{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?j_(this.code,t):t.then((e=>j_(this.code,e)))}throw Error("Unknown type, must be binary type")}}const W_=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Q_=q_({name:"sha2-256",code:18,encode:W_("SHA-256")}),Y_=q_({name:"sha2-512",code:19,encode:W_("SHA-512")}),J_=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?nI(n,$_(e),t||US.encoder):rI(n,$_(e),t||WS.encoder)},X_=new WeakMap,$_=e=>{const t=X_.get(e);if(null==t){const t=new Map;return X_.set(e,t),t}return t};class eI{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==iI)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==oI)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return eI.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=j_(e,t);return eI.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return eI.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return J_(this,e)}toJSON(){return{"/":J_(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof eI)re